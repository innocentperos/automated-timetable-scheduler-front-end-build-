import{n as z,r as i,v as H,o as k,y as U,w as u,d as C,b as t,z as e,A as r,D as M,R as K,T as W}from"./entry.tQWHpBLf.js";import{u as j}from"./fetch.EGa3nfvI.js";import{u as G}from"./use-fetch-header.3DHnPbz-.js";import{u as A}from"./use-logger.h09id-NO.js";import{u as w}from"./use-notification.Rdal1ke4.js";import{a as y,b as F}from"./form-validations.GCMU-Axm.js";import{V as J}from"./index.qvKOBlyP.js";import{V as P,a as Q,b as Y,c as Z}from"./VCard.T8BHTP73.js";import{V as _,a as s}from"./VRow.WlLBb9Jc.js";import{V as S}from"./VCheckbox.SuWXhtYw.js";import{V as h}from"./VTextField.6LPIlZmm.js";import{V as x}from"./VSelect.4u-stGGs.js";import{V as L}from"./VBtn._oQ1uiNP.js";import{V as ee}from"./VForm.Y4-k9QxA.js";import"./createSimpleFunctional.413Od-xt.js";import"./index.AmeJTHgO.js";import"./VAvatar.NX62-iRj.js";import"./transition.31NosCAE.js";import"./VCheckboxBtn.ztQGvB4X.js";import"./VInput.AAxW8xuy.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./VList.lljtylUW.js";import"./ssrBoot.0aXw1rzb.js";import"./VDivider.KeqwIEcH.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./VProgressCircular.DTBbBXDU.js";import"./VChip.ttJWPZTa.js";const Fe=z({__name:"add-staff-modal",emits:["close","add"],setup(le,{emit:N}){const q=W(),d=i(""),m=i(""),f=i(),v=i(!1),c=i(!0),p=i(!1),{data:D,pending:B}=j("/departments/",{baseURL:q.public.baseURL,default:()=>[]},"$KE8TXohWAu"),T=N,g=i(!1);async function I(){if(!g.value)return;const l=new FormData;l.append("name",d.value),l.append("staff_id",m.value),l.append("department",f.value),l.append("can_invigilate",c.value?"true":"false"),l.append("can_supervise",v.value?"true":"false"),l.append("email",R.value);try{p.value=!0;const a=await $fetch("/staffs/",{baseURL:q.public.baseURL,method:"post",headers:G([]),body:l});T("add",a),E()}catch(a){const o=a;if(A().error("Add Staff Dialog","Unable to add staff",o),o.statusCode)switch(o.statusCode){case 400:w().add({title:"Form error",text:"The values you provided in the form was invalid",icon:"mdi-page-layout-header",action(V){V()}});break;default:w().add({title:"Oops",text:"Something wrong happened on the server, try again later",icon:"mdi-server-network-off",action(V){V()}});break}else w().add({title:"Oops",text:"Make sure you have a stable internet connection and try again",icon:"mdi-wifi-strength-alert-outline",action(V){V()}})}finally{p.value=!1}}function E(){d.value="",m.value="",f.value=null,p.value=!1,T("close")}const n=i(!1),R=i(""),b=i(!1),O=i(!1),X=H(()=>!!(n.value==!1||O.value));async function $(){try{b.value=!0}catch(l){A().error("ConfirmEmail","COuld not confrim staff email",l)}finally{b.value=!1}}return(l,a)=>(k(),U(ee,{onSubmit:a[7]||(a[7]=K(()=>{},["prevent"])),modelValue:e(g),"onUpdate:modelValue":a[8]||(a[8]=o=>r(g)?g.value=o:null),disabled:e(p)},{default:u(()=>[t(P,null,{default:u(()=>[t(Q,{"primary-title":"",class:"px-6 pt-6"},{default:u(()=>[C(" Add new staff ")]),_:1}),t(Y,null,{default:u(()=>[t(_,null,{default:u(()=>[t(s,{cols:"12"},{default:u(()=>[t(S,{modelValue:e(n),"onUpdate:modelValue":a[0]||(a[0]=o=>r(n)?n.value=o:null),"hide-details":"",label:"Is a user"},null,8,["modelValue"])]),_:1}),e(n)?(k(),U(s,{key:0,cols:"12"},{default:u(()=>[t(h,{modelValue:e(R),"onUpdate:modelValue":a[1]||(a[1]=o=>r(R)?R.value=o:null),label:"Email Address",rules:["useRuleRequired"in l?l.useRuleRequired:e(y)],loading:e(b),"item-value":"pk"},null,8,["modelValue","rules","loading"])]),_:1})):M("",!0),t(s,{cols:"8"},{default:u(()=>[t(h,{name:"Name",label:"Name",id:"name",modelValue:e(d),"onUpdate:modelValue":a[2]||(a[2]=o=>r(d)?d.value=o:null),rules:["useRuleRequired"in l?l.useRuleRequired:e(y),("useRuleMinLength"in l?l.useRuleMinLength:e(F))(3)]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"4"},{default:u(()=>[t(h,{name:"staff-id",label:"Staff Id",id:"staff-id",modelValue:e(m),"onUpdate:modelValue":a[3]||(a[3]=o=>r(m)?m.value=o:null),rules:["useRuleRequired"in l?l.useRuleRequired:e(y),("useRuleMinLength"in l?l.useRuleMinLength:e(F))(3)]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12"},{default:u(()=>[t(x,{items:e(D),modelValue:e(f),"onUpdate:modelValue":a[4]||(a[4]=o=>r(f)?f.value=o:null),label:"Department",rules:["useRuleRequired"in l?l.useRuleRequired:e(y)],loading:e(B),"item-value":"pk"},null,8,["items","modelValue","rules","loading"])]),_:1}),t(s,{cols:"6"},{default:u(()=>[t(S,{modelValue:e(v),"onUpdate:modelValue":a[5]||(a[5]=o=>r(v)?v.value=o:null),label:"Can Supervise"},null,8,["modelValue"])]),_:1}),t(s,{cols:"6"},{default:u(()=>[t(S,{modelValue:e(c),"onUpdate:modelValue":a[6]||(a[6]=o=>r(c)?c.value=o:null),label:"Can Invigilate"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(Z,null,{default:u(()=>[t(J,{group:""},{default:u(()=>[e(n)?(k(),U(L,{key:0,class:"ml-4",type:"submit",color:"primary",onClick:$,loading:e(b)},{default:u(()=>[C("Validated Email")]),_:1},8,["loading"])):M("",!0),t(L,{class:"ml-4",type:"submit",color:"primary",onClick:I,loading:e(p),disabled:!e(X)},{default:u(()=>[C("Save Staff")]),_:1},8,["loading","disabled"])]),_:1}),t(L,{color:"error",onClick:E},{default:u(()=>[C("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]))}});export{Fe as default};
