import{n as z,r as n,v as G,o as k,y as U,w as u,d as y,b as t,z as e,A as s,D as E,R as H,T as J}from"./entry.tQWHpBLf.js";import{u as Q}from"./fetch.EGa3nfvI.js";import{u as X}from"./use-fetch-header.3DHnPbz-.js";import{u as F}from"./use-logger.h09id-NO.js";import{u as w}from"./use-notification.Rdal1ke4.js";import{a as C,b as N}from"./form-validations.GCMU-Axm.js";import{V as j}from"./index.qvKOBlyP.js";import{V as x,a as K,b as P,c as W}from"./VCard.T8BHTP73.js";import{V as Y,a as i}from"./VRow.WlLBb9Jc.js";import{V as S}from"./VCheckbox.SuWXhtYw.js";import{V as L}from"./VTextField.6LPIlZmm.js";import{V as Z}from"./VSelect.4u-stGGs.js";import{V as h}from"./VBtn._oQ1uiNP.js";import{V as ee}from"./VForm.Y4-k9QxA.js";const ce=z({__name:"add_staff",emits:["close","add"],setup(le,{emit:A}){const q=J(),d=n(""),m=n(""),f=n(),v=n(!1),c=n(!0),p=n(!1),{data:D,pending:B}=Q("/departments/",{baseURL:q.public.baseURL,default:()=>[]},"$Jmmu3pxGQg"),M=A,g=n(!1);async function I(){if(!g.value)return;const l=new FormData;l.append("name",d.value),l.append("staff_id",m.value),l.append("department",f.value),l.append("can_invigilate",c.value?"yes":"no"),l.append("can_supervise",v.value?"yes":"no"),l.append("email",R.value);try{p.value=!0;const a=await $fetch("/staffs/",{baseURL:q.public.baseURL,method:"post",headers:X([]),body:l});M("add",a),T()}catch(a){const o=a;if(F().error("Add Staff Dialog","Unable to add staff",o),o.statusCode)switch(o.statusCode){case 400:w().add({title:"Form error",text:"The values you provided in the form was invalid",icon:"mdi-page-layout-header",action(V){V()}});break;default:w().add({title:"Oops",text:"Something wrong happened on the server, try again later",icon:"mdi-server-network-off",action(V){V()}});break}else w().add({title:"Oops",text:"Make sure you have a stable internet connection and try again",icon:"mdi-wifi-strength-alert-outline",action(V){V()}})}finally{p.value=!1}}function T(){d.value="",m.value="",f.value=null,p.value=!1,M("close")}const r=n(!1),R=n(""),b=n(!1),O=n(!1),_=G(()=>!!(r.value==!1||O.value));async function $(){try{b.value=!0}catch(l){F().error("ConfirmEmail","COuld not confrim staff email",l)}finally{b.value=!1}}return(l,a)=>(k(),U(ee,{onSubmit:a[7]||(a[7]=H(()=>{},["prevent"])),modelValue:e(g),"onUpdate:modelValue":a[8]||(a[8]=o=>s(g)?g.value=o:null),disabled:e(p)},{default:u(()=>[t(x,null,{default:u(()=>[t(K,{"primary-title":"",class:"px-6 pt-6"},{default:u(()=>[y(" Add new staff ")]),_:1}),t(P,null,{default:u(()=>[t(Y,null,{default:u(()=>[t(i,{cols:"12"},{default:u(()=>[t(S,{modelValue:e(r),"onUpdate:modelValue":a[0]||(a[0]=o=>s(r)?r.value=o:null),"hide-details":"",label:"Is a user"},null,8,["modelValue"])]),_:1}),e(r)?(k(),U(i,{key:0,cols:"12"},{default:u(()=>[t(L,{modelValue:e(R),"onUpdate:modelValue":a[1]||(a[1]=o=>s(R)?R.value=o:null),label:"Email Address",rules:["useRuleRequired"in l?l.useRuleRequired:e(C)],loading:e(b),"item-value":"pk"},null,8,["modelValue","rules","loading"])]),_:1})):E("",!0),t(i,{cols:"8"},{default:u(()=>[t(L,{name:"Name",label:"Name",id:"name",modelValue:e(d),"onUpdate:modelValue":a[2]||(a[2]=o=>s(d)?d.value=o:null),rules:["useRuleRequired"in l?l.useRuleRequired:e(C),("useRuleMinLength"in l?l.useRuleMinLength:e(N))(3)]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"4"},{default:u(()=>[t(L,{name:"staff-id",label:"Staff Id",id:"staff-id",modelValue:e(m),"onUpdate:modelValue":a[3]||(a[3]=o=>s(m)?m.value=o:null),rules:["useRuleRequired"in l?l.useRuleRequired:e(C),("useRuleMinLength"in l?l.useRuleMinLength:e(N))(3)]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12"},{default:u(()=>[t(Z,{items:e(D),modelValue:e(f),"onUpdate:modelValue":a[4]||(a[4]=o=>s(f)?f.value=o:null),label:"Department",rules:["useRuleRequired"in l?l.useRuleRequired:e(C)],loading:e(B),"item-value":"pk"},null,8,["items","modelValue","rules","loading"])]),_:1}),t(i,{cols:"6"},{default:u(()=>[t(S,{modelValue:e(v),"onUpdate:modelValue":a[5]||(a[5]=o=>s(v)?v.value=o:null),label:"Can Supervise"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6"},{default:u(()=>[t(S,{modelValue:e(c),"onUpdate:modelValue":a[6]||(a[6]=o=>s(c)?c.value=o:null),label:"Can Invigilate"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(W,null,{default:u(()=>[t(j,{group:""},{default:u(()=>[e(r)?(k(),U(h,{key:0,class:"ml-4",type:"submit",color:"primary",onClick:$,loading:e(b)},{default:u(()=>[y("Validated Email")]),_:1},8,["loading"])):E("",!0),t(h,{class:"ml-4",type:"submit",color:"primary",onClick:I,loading:e(p),disabled:!e(_)},{default:u(()=>[y("Save Staff")]),_:1},8,["loading","disabled"])]),_:1}),t(h,{color:"error",onClick:T},{default:u(()=>[y("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]))}});export{ce as _};
