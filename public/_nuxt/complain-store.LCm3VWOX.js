import{ai as w,r as c,v as r,T as d}from"./entry.tQWHpBLf.js";import{u as p}from"./use-fetch-header.3DHnPbz-.js";import{u as L}from"./use-logger.h09id-NO.js";async function b(l,s,i,t){try{i&&i(l,!0);const n=await $fetch(`complains/${l}/`,{baseURL:d().public.baseURL,headers:p([])});s(n),t&&t(l,void 0)}catch(n){if(L().error("ComplainsStore","Could not get the complain",n),t)t(l,n);else throw n}finally{i&&i(l,!1)}}async function C(l,s,i,t){try{i&&i(l,!0);const n=await $fetch(`complains/${l}/slot/`,{baseURL:d().public.baseURL,headers:p([])});s(n),t&&t(l,void 0)}catch(n){if(L().error("ComplainsStore","Could not get the slot complains",n),t)t(l,n);else throw n}finally{i&&i(l,!1)}}const A=w("complain-store",function(){const l=c({}),s=c({}),i=c({}),t=c({}),n=c({}),v=c({});function y(a){return r(()=>l.value[a])}function R(a,o=!1){return!l.value[a]&&o==!1&&b(a,m,(e,u)=>{s.value[e]=u},(e,u)=>{i.value[e]=u}),{data:r(()=>l.value[a]),pending:r(()=>s.value[a]),refresh:()=>{b(a,m,(e,u)=>{s.value[e]=u},(e,u)=>{i.value[e]=u})}}}function _(a){return v.value[a]||C(a,o=>{v.value[a]=o.map(e=>e.pk),o.forEach(e=>m(e))},(o,e)=>{n.value[o]=e},(o,e)=>{t.value[o]=e}),{data:r(()=>v.value[a]?v.value[a].map(o=>l.value[o]):[]),pending:r(()=>n.value[a]),error:r(()=>t.value[a]),refresh:()=>{C(a,o=>{v.value[a]=o.map(e=>e.pk),o.forEach(e=>m(e))},(o,e)=>{n.value[o]=e},(o,e)=>{t.value[o]=e})}}}function g(a){return r(()=>!!l.value[a])}function S(a){return r(()=>s.value[a])}function m(a){l.value[a.pk]=a}function U(a){a.complain&&l.value[a.complain]&&l.value[a.complain].messages.push(a)}async function h(a,o,e,u){try{e.value=!0;const f=await $fetch(`complains/${a}/timetable/`,{baseURL:d().public.baseURL,headers:p([])});o.value=f}catch(f){u.value=f}finally{e.value=!1}}function $(a,o=!0){const e=c(!1),u=c(),f=c([]);return o&&h(a,f,e,u),{pending:r(()=>e.value),data:r(()=>f.value),error:r(()=>u.value),refresh:()=>{h(a,f,e,u)}}}return{get:y,set:m,load:R,isAvailable:g,isLoading:S,addMessage:U,loadSlot:_,loadTable:$}});export{A as u};
