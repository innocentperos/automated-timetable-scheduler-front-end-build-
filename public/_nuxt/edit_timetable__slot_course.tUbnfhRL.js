import{n as oe,r as V,T as S,v as x,o as d,y as f,w as e,t as n,a as l,b as t,d as i,Q as le,Z as re,c as I,z as a,A as C,L as R,at as ne,D as y,C as ie,B as ue}from"./entry.tQWHpBLf.js";import{u as de}from"./view.TfeFt1aZ.js";import{u as P}from"./fetch.EGa3nfvI.js";import{u as T}from"./use-fetch-header.3DHnPbz-.js";import{u as ce}from"./use-logger.h09id-NO.js";import{u as U}from"./use-notification.Rdal1ke4.js";import{a as pe}from"./form-validations.GCMU-Axm.js";import{a as z}from"./index.qvKOBlyP.js";import{a as me,b as fe,c as ve,V as he}from"./VCard.T8BHTP73.js";import{V as A}from"./VSpacer.t62wCS3Z.js";import{V as v}from"./VChip.ttJWPZTa.js";import{V as L}from"./VDivider.KeqwIEcH.js";import{V as _e}from"./VForm.Y4-k9QxA.js";import{V as be}from"./VContainer.HgjfEFlY.js";import{V as D,a as h}from"./VRow.WlLBb9Jc.js";import{V as $}from"./VAutocomplete.6WsM3riW.js";import{a as B}from"./VList.lljtylUW.js";import{V as Q}from"./VCheckboxBtn.ztQGvB4X.js";import{V as N}from"./VAlert.9L9TAqJu.js";import{V as ge}from"./VCheckbox.SuWXhtYw.js";import{V as Z}from"./VBtn._oQ1uiNP.js";import{V as j}from"./index.AmeJTHgO.js";import"./VProgressCircular.DTBbBXDU.js";import"./createSimpleFunctional.413Od-xt.js";import"./VAvatar.NX62-iRj.js";import"./transition.31NosCAE.js";import"./VInput.AAxW8xuy.js";import"./forwardRefs.y8pOSn8h.js";import"./VSelect.4u-stGGs.js";import"./VTextField.6LPIlZmm.js";import"./easing.imumzmxr.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./filter.y4xAiLA_.js";import"./ssrBoot.0aXw1rzb.js";const Ve={class:"px-6 py-6 d-flex flex-column"},Ce={class:"d-flex"},ye={class:"text-h5"},ke={class:"text-subtitle-2 mt-4"},we={class:"d-flex flex-wrap mt-1"},Se=l("span",null,"Supervisor *",-1),xe=l("span",{class:"pa-3 d-block text-subtitle-2"},"Select the supervisor for this course",-1),Ie={class:"d-flex"},Re={class:"d-flex my-4"},Te=l("span",null,"Venues",-1),Ue={class:"d-flex flex-column w-50 justify-end align-end"},Ae=l("span",{class:"text-subtitle-2 text-xs-right"}," The ratio of the venue capacity to course student count ",-1),Le=l("span",{class:"pa-3 d-block text-subtitle-2"},"Select the venues for this course",-1),De={class:"d-flex"},$e=l("span",null,"Invigilators",-1),Be={class:"d-flex flex-column"},Ne=l("span",{class:"pa-3 d-block text-subtitle-2"},"Select the staffs to invigilate this course",-1),qe={class:"pa-6"},Ee={key:0},Fe={key:1},Oe={class:"d-flex"},Pe=l("span",{class:"px-2"},"Close",-1),ze=l("span",{class:"px-2"},"Save",-1),xt=oe({__name:"edit_timetable__slot_course",props:{slotCourse:{},timetable:{},timetableSlot:{}},emits:["update","close"],setup(H,{emit:M}){const u=H,q=M,c=V(u.slotCourse.supervisor.pk),{data:k,pending:E,refresh:F}=de().getTimetableStaffs(u.timetable.pk),p=V(u.slotCourse.venues.map(s=>s.pk)),{data:O,pending:Y,refresh:G}=P(`/timetables/${u.slotCourse.pk}/slot_available_venues/`,{baseURL:S().public.baseURL,cache:"default",retry:5,retryDelay:500,headers:T([]),default(){return u.slotCourse.venues}},"$rIa1e8ZlSu"),m=x(()=>{let s=0;for(const r of O.value.filter(o=>p.value.includes(o.pk)))s=s+r.capacity;return s}),{data:J,pending:K,refresh:W}=P(`/timetables/${u.slotCourse.pk}/slot_available_staffs/`,{baseURL:S().public.baseURL,cache:"default",retry:5,retryDelay:500,headers:T([]),default(){return u.slotCourse.invigilators}},"$m5ehhQyAIq");function X(){W(),F()}const b=V(!0),_=V(u.slotCourse.invigilators.map(s=>s.pk)),ee=x(()=>J.value.map(s=>s.pk)),te=x(()=>b.value?k.value.filter(s=>s.department.pk==u.slotCourse.course.department.pk):k.value),w=V(!1);async function se(){const s=new FormData;s.append("supervisor",c.value.toString()),p.value.forEach(r=>{s.append("venues",r.toString())}),_.value.forEach(r=>{s.append("invigilators",r.toString())});try{const r=await $fetch(`/timetables/${u.slotCourse.pk}/update_slot_course/`,{baseURL:S().public.baseURL,method:"POST",headers:T([]),body:s});q("update",r)}catch(r){const o=r;if(ce().error("Edit Timetable Slot Course","Unable to update slot course",o),!o.statusCode)U().add({title:"Oops",text:"Could not update course slot, please make sure you have a stable internet connection and try again.",icon:"mdi-network-off",closable:!0,color:"red"});else switch(o.statusCode){case 400:U().add({title:"Missing fields",text:"Please provide all the required fields marked with *",icon:"mdi-alert-circle",closable:!0,color:"warning"});break;default:U().add({title:"Error occured",text:"Something went wrong on the server, please try again later",icon:"mdi-alert-circle",closable:!0,color:"warning"});break}}}function ae(){q("close")}return(s,r)=>(d(),f(he,null,{default:e(()=>[t(me,null,{default:e(()=>[l("div",Ve,[l("div",Ce,[l("span",ye,n(s.slotCourse.course.title)+" ("+n(s.slotCourse.course.code)+") ",1),t(A),t(v,{class:"ml-auto"},{default:e(()=>[i(n(s.slotCourse.course.department.title)+" "+n(s.slotCourse.course.department.code),1)]),_:1})]),l("span",ke," Offered by "+n(s.slotCourse.course.student_count)+" Students across "+n(s.slotCourse.course.departments.length)+" department"+n(s.slotCourse.course.departments.length>1?"s":""),1),l("div",we,[(d(!0),I(le,null,re(s.slotCourse.course.departments,o=>(d(),f(v,{key:o.pk,class:"mr-2"},{default:e(()=>[i(n(o.title),1)]),_:2},1024))),128))])])]),_:1}),t(L),t(fe,{class:"pa-0",style:{height:"100%"}},{default:e(()=>[t(_e,{modelValue:a(w),"onUpdate:modelValue":r[4]||(r[4]=o=>C(w)?w.value=o:null)},{default:e(()=>[t(be,{fluid:""},{default:e(()=>[t(D,{class:"pa-6"},{default:e(()=>[t(h,{cols:12},{default:e(()=>[Se]),_:1}),t(h,{cols:12},{default:e(()=>[t($,{modelValue:a(c),"onUpdate:modelValue":r[0]||(r[0]=o=>C(c)?c.value=o:null),items:a(k),"item-title":"name","item-value":"pk",loading:a(E),label:"Supervisor *",rules:["useRuleRequired"in s?s.useRuleRequired:a(pe)],"append-inner-icon":"mdi-refresh","onClick:appendInner":a(F)},{"prepend-item":e(()=>[xe]),item:e(({item:o,props:g})=>[t(B,R(g,{disabled:o.raw.pk==a(c),class:"py-4"}),{subtitle:e(()=>[l("div",Ie,[t(v,null,{default:e(()=>[i(n(o.raw.department.title),1)]),_:2},1024)])]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","loading","rules","onClick:appendInner"])]),_:1})]),_:1}),t(L),t(D,{"no-gutters":"",class:"pa-6"},{default:e(()=>[t(h,{cols:12},{default:e(()=>[l("div",Re,[Te,t(A),l("div",Ue,[t(v,{class:ne(["mb-2",{"text-red":a(m)/s.slotCourse.course.student_count<1,"text-amber":a(m)/s.slotCourse.course.student_count>1&&a(m)/s.slotCourse.course.student_count<1.3,"text-teal":a(m)/s.slotCourse.course.student_count>1.3}])},{default:e(()=>[i(n(a(m))+" / "+n(s.slotCourse.course.student_count),1)]),_:1},8,["class"]),Ae])])]),_:1}),t(h,{cols:12},{default:e(()=>[t($,{modelValue:a(p),"onUpdate:modelValue":r[1]||(r[1]=o=>C(p)?p.value=o:null),items:a(O),"item-title":"title","item-value":"pk",loading:a(Y),label:"Venues",multiple:"",chips:"","append-inner-icon":"mdi-refresh","onClick:appendInner":a(G)},{"prepend-item":e(()=>[Le]),item:e(({item:o,props:g})=>[t(B,R(g,{class:"pa-3 py-4 mb-1"}),{prepend:e(()=>[t(Q,{"model-value":a(p).includes(o.value)},null,8,["model-value"])]),title:e(()=>[i(n(o.title),1)]),subtitle:e(()=>[i(n(o.raw.capacity)+" Students",1)]),_:2},1040)]),_:1},8,["modelValue","items","loading","onClick:appendInner"]),t(z,{group:""},{default:e(()=>[a(m)/s.slotCourse.course.student_count>1.3?(d(),f(N,{key:0,type:"warning",translate:"yes"},{default:e(()=>[i(" The venue(s) selected capacity was exceeded the course capacity by morethan 30%, which is the margin for error, consider reducing the venues selected. ")]),_:1})):y("",!0),a(m)/s.slotCourse.course.student_count<1?(d(),f(N,{key:1,type:"error",translate:"yes"},{default:e(()=>[i(" The venue(s) selected capacity is lessthan the course student count, consider selecting a venue of higher capacity or more venues. ")]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1}),t(L),t(D,{"no-gutters":"",class:"pa-6"},{default:e(()=>[t(h,{cols:12,class:"py-4"},{default:e(()=>[l("div",De,[$e,t(A)])]),_:1}),t(h,{cols:12,class:"pb-2"},{default:e(()=>[t(z,null,{default:e(()=>[a(_).length<a(p).length?(d(),f(N,{key:0,type:"warning",translate:"yes"},{default:e(()=>[i(" The number of selected invigilators is lessthan the number of selected venues, There will not be enough staffs to invigilator all venues. Consider adding more invigilators or reduce venues by selected venues with higher capacity. ")]),_:1})):y("",!0)]),_:1})]),_:1}),t(h,{cols:12},{default:e(()=>[t($,{modelValue:a(_),"onUpdate:modelValue":r[3]||(r[3]=o=>C(_)?_.value=o:null),items:a(te),"item-title":"name","item-value":"pk",loading:a(E)||a(K),label:"Invigilators",multiple:"",chips:"","append-inner-icon":"mdi-refresh","onClick:appendInner":X},{"prepend-item":e(()=>[l("div",Be,[Ne,t(ge,{label:`Show only ${s.slotCourse.course.department.title} (${s.slotCourse.course.department.code}) department staff`,modelValue:a(b),"onUpdate:modelValue":r[2]||(r[2]=o=>C(b)?b.value=o:null),"hide-details":""},null,8,["label","modelValue"])])]),"no-data":e(()=>[l("div",qe,[a(k).length<1?(d(),I("span",Ee," Timetable has no staff selected ")):(d(),I("span",Fe," No staff from "+n(s.slotCourse.course.department.title)+" department is available ",1))])]),item:e(({item:o,props:g})=>[t(B,R(g,{disabled:o.raw.pk==a(c),class:"py-4"}),{prepend:e(()=>[t(Q,{"model-value":a(_).includes(o.value)},null,8,["model-value"])]),subtitle:e(()=>[l("div",Oe,[a(b)?y("",!0):(d(),f(v,{key:0,class:"mr-1"},{default:e(()=>[i(n(o.raw.department.code),1)]),_:2},1024)),o.raw.pk==a(c)?(d(),f(v,{key:1,class:"mr-1"},{default:e(()=>[i(" is supervising ")]),_:1})):y("",!0),ue(t(v,{class:"mr-1",color:"warning"},{default:e(()=>[i(" busy ")]),_:2},1536),[[ie,!a(ee).includes(o.value)]])])]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(ve,null,{default:e(()=>[t(Z,{color:"error",variant:"outlined",onClick:ae},{default:e(()=>[t(j,null,{default:e(()=>[i("mdi-close")]),_:1}),Pe]),_:1}),t(Z,{variant:"elevated",color:"primary",disabled:!a(w),onClick:se},{default:e(()=>[t(j,null,{default:e(()=>[i("mdi-content-save")]),_:1}),ze]),_:1},8,["disabled"])]),_:1})]),_:1}))}});export{xt as default};
