import{n as q,r as i,o as U,y as x,w as e,z as l,t as S,d as m,b as t,C as W,B as X,A as k,R as G,T as B,V as J,q as Q,W as Y,v as L,X as Z,h as ee,D as te,a as A}from"./entry.tQWHpBLf.js";import{u as $}from"./use-fetch-header.3DHnPbz-.js";import{u as oe}from"./use-logger.h09id-NO.js";import{a as E,b as le,c as ae}from"./form-validations.GCMU-Axm.js";import{V as F,b as z,a as H,c as I}from"./VCard.T8BHTP73.js";import{V as ne}from"./VBanner.T3kYHC40.js";import{V as b}from"./VBtn._oQ1uiNP.js";import{V as D,a as h}from"./VRow.WlLBb9Jc.js";import{V as T}from"./VTextField.6LPIlZmm.js";import{V as re}from"./VForm.Y4-k9QxA.js";import{_ as se}from"./nuxt-link.tq0YTiuG.js";import{u as M}from"./use-notification.Rdal1ke4.js";import{u as ie}from"./departments-store.L9CsyjDw.js";import{u as ue}from"./fetch.EGa3nfvI.js";import{V as N}from"./VDialog.SCbeIy52.js";import{V as de}from"./VSpacer.t62wCS3Z.js";import{V as me}from"./VDataTable.Jz7QZbN2.js";import{V as ce}from"./index.AmeJTHgO.js";import{V as pe}from"./VSkeletonLoader.bS24LWfm.js";import{V as fe}from"./VContainer.HgjfEFlY.js";import"./createSimpleFunctional.413Od-xt.js";import"./VAvatar.NX62-iRj.js";import"./transition.31NosCAE.js";import"./VProgressCircular.DTBbBXDU.js";import"./index.qvKOBlyP.js";import"./VInput.AAxW8xuy.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./courses-store.hFHtJJlz.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./dialog-transition.OyYDh7J5.js";import"./VSelect.4u-stGGs.js";import"./VList.lljtylUW.js";import"./ssrBoot.0aXw1rzb.js";import"./VDivider.KeqwIEcH.js";import"./VMenu.CmTKH41A.js";import"./VCheckboxBtn.ztQGvB4X.js";import"./VChip.ttJWPZTa.js";import"./filter.y4xAiLA_.js";const ve=q({__name:"add_department",emits:["error","close","add"],setup(j,{emit:w}){const f=w,v=i(""),c=i(""),V=i(!1),u=i(!1),p=i(""),y=i(""),_=i(!1);function r(o,n=""){p.value=o,y.value=n,_.value=!0}const g=B();async function R(){if(V.value)try{u.value=!0;const o=await $fetch("/departments/",{headers:$([]),baseURL:g.public.baseURL,method:"post",body:{title:v.value,code:c.value}});f("add",o),f("close")}catch(o){if(f("error",o),o.data){const n=o;switch(oe().error("Add Department Dialog","Unable to add department",n),n.statusCode){case 400:r("The details you provided was invalid","mdi-information-variant-circle");break;default:r("Something went wrong on the server, try again later","mdi-server-network-off");break}}else r("Oops, could not connect to the server make sure you have a stable internect connecttion","mdi-wifi-strength-alert-outline")}finally{u.value=!1}}function C(){v.value="",c.value=="",_.value=!1,p.value="",y.value="",f("close")}return(o,n)=>(U(),x(re,{modelValue:l(V),"onUpdate:modelValue":n[3]||(n[3]=a=>k(V)?V.value=a:null),onSubmit:n[4]||(n[4]=G(()=>{},["prevent"]))},{default:e(()=>[t(F,null,{default:e(()=>[X(t(ne,{stick:"top",lines:"one",icon:l(y)},{text:e(()=>[m(S(l(p)),1)]),actions:e(()=>[t(b,{color:"error",onClick:n[0]||(n[0]=a=>_.value=!1)},{default:e(()=>[m(" close ")]),_:1})]),_:1},8,["icon"]),[[W,l(p)&&l(_)]]),t(z,null,{default:e(()=>[t(H,{"primary-title":""},{default:e(()=>[m(" Adding Department ")]),_:1}),t(D,null,{default:e(()=>[t(h,{cols:"12"},{default:e(()=>[t(T,{name:"title",label:"Department title",modelValue:l(v),"onUpdate:modelValue":n[1]||(n[1]=a=>k(v)?v.value=a:null),rules:["useRuleRequired"in o?o.useRuleRequired:l(E),("useRuleMinLength"in o?o.useRuleMinLength:l(le))(3)]},null,8,["modelValue","rules"])]),_:1}),t(h,{cols:"12"},{default:e(()=>[t(T,{name:"code",label:"Department code",modelValue:l(c),"onUpdate:modelValue":n[2]||(n[2]=a=>k(c)?c.value=a:null),counter:10,rules:["useRuleRequired"in o?o.useRuleRequired:l(E),("useRuleMaxLength"in o?o.useRuleMaxLength:l(ae))(10)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),t(I,{class:"pb-4"},{default:e(()=>[t(b,{color:"primary",variant:"outlined",class:"ml-4",onClick:R,loading:l(u),type:"submit",disabled:!l(V)},{default:e(()=>[m("Add Department")]),_:1},8,["loading","disabled"]),t(b,{color:"red",onClick:C},{default:e(()=>[m("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ve=A("span",{class:"text-h5 text-uppercase"},"Departments",-1),_e={class:"d-flex items-center"},ge={class:"text-primary"},nt=q({__name:"index",setup(j){const w=[{title:"Title",key:"title",value:"title"},{title:"Code",key:"code",value:"code"},{title:"Staff Count",key:"staff_count",value:"staff_count"},{title:"Courses Count",key:"course_count",value:"course_count"}],f=B(),{add:v}=M(),{addAction:c,removeActions:V}=J(),u=i({model:!1}),p=[],y=Q();Y(()=>{p.push(c({title:"New Department",description:"Add an new department",icon:"mdi-plus",color:"primary",hidden:L(()=>!y.isAdmin.value),action(){u.value.model=!0}})),p.push(c({title:"Delete",description:L(()=>`delete the ${r.value.length} departments`),icon:"mdi-delete",color:"error",hidden:L(()=>r.value.length<1),action(){o.value.model=!0}}))}),Z(()=>{try{V(p)}catch(a){console.log("Error rmoving actions"),console.log(a)}});const _=ie(),r=i([]),{data:g,pending:R}=ue("/departments/",{baseURL:f.public.baseURL,headers:$([]),default(){return[]}},"$HzKRPqelD2");ee(R,()=>{_.bulkInsert(g.value)});function C(a){g.value.push(a),u.value.model=!1,v({text:`${a.title} was added Successfully`,icon:"mdi-check-all",color:"teal",closable:!0,action(s){s()}}),_.insert(a)}const o=i({model:!1,pending:!1});async function n(){if(!(r.value.length<1))try{o.value.pending=!0,await $fetch("/courses/multiple_delete/",{baseURL:f.public.baseURL,method:"DELETE",headers:$([]),body:r.value}),g.value=g.value.filter(a=>!r.value.includes(a.pk)),M().add({text:`Successfully deleted ${r.value.length} departments`,icon:"mdi-delete",color:"teal",action:a=>a()}),r.value=[]}catch(a){console.log({error:a})}finally{o.value.pending=!1,o.value.model=!1}}return(a,s)=>{const K=ve,O=se;return U(),x(fe,null,{default:e(()=>[t(D,null,{default:e(()=>[t(h,{cols:"1"},{default:e(()=>[t(N,{modelValue:l(u).model,"onUpdate:modelValue":s[1]||(s[1]=d=>l(u).model=d),location:"top center",persistent:"","max-width":"500"},{default:e(()=>[t(K,{onAdd:C,onClose:s[0]||(s[0]=d=>l(u).model=!1)})]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:e(()=>[t(N,{modelValue:l(o).model,"onUpdate:modelValue":s[3]||(s[3]=d=>l(o).model=d),location:"top center",persistent:"","max-width":"400"},{default:e(()=>[t(F,null,{default:e(()=>[t(H,{class:"headline"},{default:e(()=>[m("Delete "+S(l(r).length)+" Departments",1)]),_:1}),t(z,null,{default:e(()=>[m("Are you sure you want to delete the selected departments")]),_:1}),t(I,null,{default:e(()=>[t(de),t(b,{color:"primary",flat:"",onClick:s[2]||(s[2]=d=>l(o).model=!1)},{default:e(()=>[m("Cancel")]),_:1}),l(r).length>0?(U(),x(b,{key:0,size:"large",color:"red",loading:l(o).pending,onClick:n},{default:e(()=>[m("DELETE")]),_:1},8,["loading"])):te("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(D,null,{default:e(()=>[t(h,null,{default:e(()=>[t(me,{headers:w,items:l(g),loading:l(R),"show-select":"",modelValue:l(r),"onUpdate:modelValue":s[4]||(s[4]=d=>k(r)?r.value=d:null),"item-value":"pk"},{top:e(()=>[t(D,{justify:"center"},{default:e(()=>[t(h,{class:"pa-12"},{default:e(()=>[Ve]),_:1})]),_:1})]),"item.title":e(({item:d,value:P})=>[t(O,{to:`/departments/${d.pk}/`},{default:e(()=>[A("div",_e,[A("span",ge,S(P),1),t(ce,{icon:"mdi-launch",color:"primary",class:"d-inline-block ml-2"})])]),_:2},1032,["to"])]),loading:e(()=>[t(pe,{type:"table-row@6"})]),_:1},8,["items","loading","modelValue"])]),_:1})]),_:1})]),_:1})}}});export{nt as default};
