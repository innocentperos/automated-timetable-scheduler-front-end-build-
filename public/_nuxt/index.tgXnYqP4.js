import{n as ee,s as te,V as le,W as oe,v as R,q as O,X as ae,h as se,r as b,T as $,o as d,y as c,w as t,b as l,z as o,R as q,d as u,D as f,c as z,Z as re,Q as ne,a as v,t as D,L as ie,$ as ue,x as M,a0 as de}from"./entry.tQWHpBLf.js";import me from"./is-authenticated.2_vl-wsG.js";import{u as p}from"./use-notification.Rdal1ke4.js";import{u as ce}from"./form-validations.GCMU-Axm.js";import{u as pe}from"./timetables-store.awZnM9r_.js";import{u as fe}from"./fetch.EGa3nfvI.js";import{u as w}from"./use-fetch-header.3DHnPbz-.js";import{S as _e}from"./types.H3O6Ekup.js";import{a as ve}from"./index.qvKOBlyP.js";import{a as _,V as x}from"./VRow.WlLBb9Jc.js";import{V as Ve}from"./VDialog.SCbeIy52.js";import{V as be}from"./VForm.Y4-k9QxA.js";import{V as A,a as ye,b as E,c as ke}from"./VCard.T8BHTP73.js";import{V as j}from"./VTextField.6LPIlZmm.js";import{V as ge}from"./VSelect.4u-stGGs.js";import{V as y,c as he}from"./VBtn._oQ1uiNP.js";import{V as Y}from"./VSpacer.t62wCS3Z.js";import{V as we}from"./VProgressCircular.DTBbBXDU.js";import{V as G}from"./index.AmeJTHgO.js";import{V as xe}from"./VContainer.HgjfEFlY.js";import{V as Ce}from"./VAvatar.NX62-iRj.js";import{V as Te}from"./VTooltip.gJvVvmRp.js";import"./VOverlay.1V9m9YmJ.js";import"./easing.imumzmxr.js";import"./lazy.hsVx4m50.js";import"./transition.31NosCAE.js";import"./forwardRefs.y8pOSn8h.js";import"./dialog-transition.OyYDh7J5.js";import"./VInput.AAxW8xuy.js";import"./createSimpleFunctional.413Od-xt.js";import"./VList.lljtylUW.js";import"./ssrBoot.0aXw1rzb.js";import"./VDivider.KeqwIEcH.js";import"./VMenu.CmTKH41A.js";import"./VCheckboxBtn.ztQGvB4X.js";import"./VChip.ttJWPZTa.js";const Se=ue(()=>de(()=>import("./is-authenticated.2_vl-wsG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url).then(C=>C.default||C)),Ue={key:0},Le={class:"d-flex justify-space-between align-center w-100"},Ne={class:"text-subtitle-1 text-uppercase"},Re={class:"d-flex flex-column mt-auto"},$e={class:"text-subtitle-2"},De=v("span",null,"New Table",-1),Vt=ee({__name:"index",setup(C){te("default");const I=$(),{addAction:B,removeActions:H}=le(),{add:k}=p(),{minLen:F,required:T}=ce(),S=[];oe(()=>{S.push(B({title:"New Table",icon:"mdi-plus",hidden:R(()=>!O().isAdmin.value),action(){r.value.model=!0}})),S.push(B({title:"Delete selected",icon:"mdi-delete",color:"error",hidden:R(()=>n.value.length<=0),loading:R(()=>L.value),action(){K()}}))}),ae(()=>{H(S)});const Q=pe(),{data:m,pending:P}=fe("/timetables/",{default:()=>[],baseURL:I.public.baseURL,headers:w([])},"$xYaomOvGig");se(m,()=>{Q.bulkInsert(m.value)});const r=b({model:!1,title:"",semester:1,session:"2023/2024",pending:!1,form:!1});async function W(){if(r.value.form)try{r.value.pending=!0;const s=await $fetch("/timetables/",{method:"post",baseURL:I.public.baseURL,headers:w([]),body:{title:r.value.title,session:r.value.session,semester:r.value.semester},retryDelay:300,retry:5});m.value.push(s),k({text:`Timetable \`${s.title}\` was created`,icon:"mdi-check-all",color:"teal"}),r.value.model=!1,r.value.title=""}catch(s){const e=s;if(!e.response){k({text:"Oops, make sure you have an internet connection and try again",icon:"mdi-wifi-alert",color:"error"});return}switch(e.response.status){case 400:k({text:"Oops,the information you provided is not valid",color:"error",icon:"mdi-finbox-full"});break;default:k({text:"Oops,something wrong happened on the server, please try again",color:"error",icon:"mdi-server"});break}}finally{r.value.pending=!1}}function X(s,e){i.value?(s.preventDefault(),s.stopPropagation(),Z(e.pk)):O().isAdmin.value?M().push("/time-tables/"+e.pk):M().push({name:"time-tables-timetable_pk-view",params:{timetable_pk:e.pk}})}const n=b([]),i=b(!1);function Z(s){U(s)?n.value=n.value.filter(e=>e!=s):n.value.push(s)}function U(s){return n.value.includes(s)}const V=b(0);async function J(s){try{V.value=s.pk,await $fetch(`/timetables/${s.pk}/set_current/`,{baseURL:$().public.baseURL,headers:w([])}),m.value=m.value.map(e=>(e.is_current&&(e.is_current=!1),e.pk==V.value&&(e.is_current=!0),e))}catch(e){const g=e;if(!g.statusCode)p().postNetowrkIssue();else switch(g.statusCode){case 404:p().add({title:"Not found",text:"The timetable you tried to set as the default could not be found",color:"warning",closable:!0,action(h){h()}});break;default:p().postServerIssue()}}finally{V.value=0}}const L=b(!1);async function K(){try{L.value=!0,await $fetch("/timetables/multiple/",{baseURL:$().public.baseURL,method:"DELETE",body:n.value,headers:w([])}),m.value=m.value.filter(s=>!n.value.includes(s.pk)),p().add({title:"Deleted",text:`${n.value.length} timetable ${n.value.length<=1?"was":"were"} deleted successfully`,color:"success",closable:!0,action(s){s()}}),n.value=[]}catch(s){const e=s;if(!e.statusCode)p().postNetowrkIssue();else switch(e.statusCode){default:p().postServerIssue()}}finally{L.value=!1}}return(s,e)=>{const g=me,h=Se;return d(),c(xe,null,{default:t(()=>[l(x,null,{default:t(()=>[l(_,null,{default:t(()=>[l(Ve,{modelValue:o(r).model,"onUpdate:modelValue":e[6]||(e[6]=a=>o(r).model=a),location:"center center","max-width":"400",persistent:""},{default:t(()=>[l(be,{modelValue:o(r).form,"onUpdate:modelValue":e[4]||(e[4]=a=>o(r).form=a),onSubmit:e[5]||(e[5]=q(()=>{},["prevent"]))},{default:t(()=>[l(A,null,{default:t(()=>[l(ye,null,{default:t(()=>[u(" Create New Timetable ")]),_:1}),l(E,null,{default:t(()=>[l(j,{name:"title",label:"Title",id:"title",modelValue:o(r).title,"onUpdate:modelValue":e[0]||(e[0]=a=>o(r).title=a),rules:[o(T),o(F)(3)]},null,8,["modelValue","rules"]),l(ge,{items:o(_e),modelValue:o(r).semester,"onUpdate:modelValue":e[1]||(e[1]=a=>o(r).semester=a),label:"Semester","item-title":"title","item-value":"value",rules:[o(T)]},null,8,["items","modelValue","rules"]),l(j,{name:"session",label:"Session",modelValue:o(r).session,"onUpdate:modelValue":e[2]||(e[2]=a=>o(r).session=a),rules:[o(T),o(F)(4)]},null,8,["modelValue","rules"])]),_:1}),l(ke,null,{default:t(()=>[l(y,{type:"submit",onClick:W,color:"primary",loading:o(r).pending},{default:t(()=>[u("Create")]),_:1},8,["loading"]),l(y,{onClick:e[3]||(e[3]=a=>o(r).model=!1),color:"error"},{default:t(()=>[u("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,null,{default:t(()=>[l(_,null,{default:t(()=>[u(" Timetables ")]),_:1}),l(Y),l(g,{"user-type":"admin"},{default:t(()=>[l(_,{cols:"auto",class:"d-flex"},{default:t(()=>[l(he,{mandatory:"",multiple:"",color:"primary"},{default:t(()=>[l(y,{onClick:e[7]||(e[7]=a=>i.value=!o(i)),color:o(i)?"primary":""},{default:t(()=>[u("Select ")]),_:1},8,["color"]),o(i)?(d(),c(y,{key:0,onClick:e[8]||(e[8]=a=>i.value=!o(i))},{default:t(()=>[u("All ")]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(x,null,{default:t(()=>[o(P)?(d(),c(_,{key:0,cols:"12",class:"d-flex pa-5 justify-center align-center"},{default:t(()=>[l(we,{color:"primary",indeterminate:""})]),_:1})):f("",!0)]),_:1}),o(P)?f("",!0):(d(),c(x,{key:0},{default:t(()=>[(d(!0),z(ne,null,re(o(m),a=>(d(),c(_,{cols:"4",lg:"3",key:a.pk},{default:t(()=>[l(A,{class:"aspect-square relative",color:o(i)?U(a.pk)?"error":"":a.is_current?"indigo":"",onClick:N=>X(N,a)},{default:t(()=>[l(E,{class:"w-100 h-100 d-flex flex-column"},{default:t(()=>[l(ve,null,{default:t(()=>[U(a.pk)&&o(i)?(d(),z("span",Ue,"selected")):f("",!0)]),_:2},1024),v("div",Le,[v("span",Ne,D(a.title),1),l(Y),o(i)?f("",!0):(d(),c(Ce,{key:0,color:a.is_current?"white":"transparent"},{default:t(()=>[l(G,{color:a.is_current?"indigo":"transparent"},{default:t(()=>[u("mdi-check")]),_:2},1032,["color"])]),_:2},1032,["color"]))]),v("div",Re,[v("span",$e,D(a.courses.length)+" Courses",1),v("span",null,D(new Date(a.created_on)),1)]),l(h,{"user-type":"admin"},{default:t(()=>[l(Te,{location:"bottom"},{activator:t(({props:N})=>[a.is_current?f("",!0):(d(),c(y,ie({key:0},N,{variant:"tonal",class:"mt-2","prepend-icon":"mdi-check",onClick:q(Ae=>J(a),["stop"]),disabled:o(V)>0,loading:o(V)==a.pk}),{default:t(()=>[u("mark current")]),_:2},1040,["onClick","disabled","loading"]))]),default:t(()=>[u(" This will be the timetable that students will be able to access and view ")]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["color","onClick"])]),_:2},1024))),128)),l(h,{"user-type":"admin"},{default:t(()=>[l(_,{cols:"4",lg:"3"},{default:t(()=>[l(A,{class:"aspect-square cursor-pointer",color:"teal",onClick:e[9]||(e[9]=a=>o(r).model=!0)},{default:t(()=>[l(E,{class:"h-100 w-100 d-flex flex-column align-center justify-center"},{default:t(()=>[De,l(G,{size:"42"},{default:t(()=>[u("mdi-plus")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})}}});export{Vt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./is-authenticated.2_vl-wsG.js","./entry.tQWHpBLf.js","./entry.JkaK1PbT.css","./VBtn._oQ1uiNP.js","./index.AmeJTHgO.js","./VRow.WlLBb9Jc.js","./VRow.Jj_ITn01.css","./index.RLmRraAs.css","./VProgressCircular.DTBbBXDU.js","./VProgressCircular.u2v1YYMj.css","./VBtn.Y_2JgC81.css","./is-authenticated.MRbMt392.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}