import{_ as ve}from"./add_course.vue.mMU39b5L.js";import{n as be,h as ke,r as g,v as z,o as u,y as _,w as t,z as i,b as s,d as c,Q as V,Z as C,c as m,D as U,t as b,C as J,B as Q,a as d,L as B,A as _e,T as he,x as S}from"./entry.tQWHpBLf.js";import{u as ye}from"./timetables-store.awZnM9r_.js";import{u as Z}from"./fetch.EGa3nfvI.js";import{u as w}from"./use-fetch-header.3DHnPbz-.js";import{u as v}from"./use-notification.Rdal1ke4.js";import{L as j}from"./types.H3O6Ekup.js";import{V as G}from"./index.qvKOBlyP.js";import{V as ge,a as K}from"./VRow.WlLBb9Jc.js";import{V as W,b as Y}from"./VCard.T8BHTP73.js";import{V as ee,a as A,b as D}from"./VList.lljtylUW.js";import{V as T}from"./VCheckboxBtn.ztQGvB4X.js";import{V as te}from"./VDivider.KeqwIEcH.js";import{V as ae}from"./VSkeletonLoader.bS24LWfm.js";import{V as Ve}from"./VAlert.9L9TAqJu.js";import{V as R}from"./VChip.ttJWPZTa.js";import{V as O}from"./VProgressCircular.DTBbBXDU.js";import{V as F}from"./VTooltip.gJvVvmRp.js";import{V as I}from"./index.AmeJTHgO.js";import{V as Ce}from"./VDialog.SCbeIy52.js";import{V as we}from"./VContainer.HgjfEFlY.js";import"./use-logger.h09id-NO.js";import"./form-validations.GCMU-Axm.js";import"./VBanner.T3kYHC40.js";import"./createSimpleFunctional.413Od-xt.js";import"./VAvatar.NX62-iRj.js";import"./transition.31NosCAE.js";import"./VBtn._oQ1uiNP.js";import"./VTextField.6LPIlZmm.js";import"./VInput.AAxW8xuy.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./VSelect.4u-stGGs.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./VForm.Y4-k9QxA.js";import"./ssrBoot.0aXw1rzb.js";const xe={key:0,class:"d-flex flex-column"},Le={key:0,class:"d-flex flex-column"},Ue=d("div",{class:"d-block ma-2"},"Selected Courses",-1),Re={key:0,class:"d-block mx-2"},$e=d("span",{class:"text-subtitle-1"},"No course selected into this table",-1),Se=d("br",null,null,-1),Ae=d("span",{class:"text-body-1"},"Click on a course in the course poll to add it into this timetable",-1),De={class:"d-flex justify-center align-center"},Te=d("span",null,"Remove All Courses",-1),Oe=d("br",null,null,-1),Ee=d("div",{class:"d-block ma-2 mt-5"},"Course Poll",-1),Me={class:"d-flex justify-center align-center"},Ne=d("span",null,"Add All Courses",-1),Pe=d("br",null,null,-1),ze={class:"d-block ma-1",key:"add-course"},Be=d("div",null,"Add a new course",-1),Ut=be({__name:"timetable__courses_picker",props:{tablePk:{}},setup(le){const se=le,h=he(),o=ye().retrieve(se.tablePk),{data:y,pending:H}=Z("/departments/",{baseURL:h.public.baseURL,headers:w([]),default:()=>[]},"$MdVXFNMHz9");ke(y,()=>{y.value.length>0&&p.value.length<=0&&(p.value=y.value.map(a=>a.pk))});const f=g([]),p=g([]);function oe(a,l){l?p.value.push(a.pk):p.value=p.value.filter(r=>r!=a.pk)}function re(a){a==!1?p.value=[]:p.value=y.value.map(l=>l.pk)}function ie(a,l){l?f.value.push(a.value):f.value=f.value.filter(r=>r!=a.value)}function ne(a){a==!1?f.value=[]:f.value=j.map(l=>l.value)}const{data:E}=Z("/courses/?semester=",{baseURL:h.public.baseURL,headers:w([]),default:()=>[]},"$xqyTJImSc2"),X=z(()=>E.value.filter(a=>{var l,r;return p.value.includes(a.department.pk)&&!((l=o.value)!=null&&l.courses.includes(a.pk))&&(f.value.includes(a.level)||f.value.length==0)&&a.semester==((r=o.value)==null?void 0:r.semester)})),M=z(()=>E.value.filter(a=>{var l;return(l=o.value)==null?void 0:l.courses.includes(a.pk)})),ue=z(()=>X.value.filter(a=>{var l;return!((l=o.value)!=null&&l.courses.includes(a.pk))})),$=g({});async function q(a){if(o.value)try{$.value[a.pk]=!0,o.value.courses.includes(a.pk)?await de(a):await me(a)}finally{$.value[a.pk]=!1}}async function de(a){var l,r;try{await $fetch(`/timetables/${(l=o.value)==null?void 0:l.pk}/courses/`,{method:"DELETE",baseURL:h.public.baseURL,body:[a.pk],headers:w([])}),o.value&&(o.value.courses=(r=o.value)==null?void 0:r.courses.filter(e=>e!=a.pk))}catch(e){const n=e;if(!n.statusCode)v().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(n.statusCode){case 404:S().push("/time-tables");break;default:v().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}}const N=g(!1);async function ce(){var l;const a=M.value.map(r=>r.pk);try{N.value=!0,await $fetch(`/timetables/${(l=o.value)==null?void 0:l.pk}/courses/`,{method:"DELETE",baseURL:h.public.baseURL,body:a,headers:w([])}),o.value&&(o.value.courses=o.value.courses.filter(r=>!a.includes(r)))}catch(r){const e=r;if(!e.statusCode)v().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(e.statusCode){case 404:S().push("/time-tables");break;default:v().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{N.value=!1}}async function me(a){var l,r;try{await $fetch(`/timetables/${(l=o.value)==null?void 0:l.pk}/courses/`,{method:"POST",baseURL:h.public.baseURL,body:[a.pk],headers:w([])}),(r=o.value)==null||r.courses.push(a.pk)}catch(e){const n=e;if(!n.statusCode)v().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(n.statusCode){case 404:S().push("/time-tables");break;default:v().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}}const P=g(!1);async function pe(){var l;const a=X.value.map(r=>r.pk);try{P.value=!0,await $fetch(`/timetables/${(l=o.value)==null?void 0:l.pk}/courses/`,{method:"POST",baseURL:h.public.baseURL,body:a,headers:w([])}),o.value&&(o.value.courses=[...o.value.courses,...a])}catch(r){const e=r;if(!e.statusCode)v().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(e.statusCode){case 404:S().push("/time-tables");break;default:v().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{P.value=!1}}const x=g(!1);function fe(a){E.value.push(a),v().add({text:`${a.title} added to courses`,icon:"mdi-check-all",color:"teal",closable:!0})}return(a,l)=>{const r=ve;return u(),_(we,{fluid:""},{default:t(()=>[s(ge,{"no-gutters":""},{default:t(()=>[s(K,{cols:"12",lg:3},{default:t(()=>[s(W,{elevation:"0",color:"primary",class:"mb-4"},{default:t(()=>[s(Y,{class:"pa-0"},{default:t(()=>[s(ee,{"bg-color":"primary",density:"compact"},{default:t(()=>[s(A,null,{append:t(()=>[s(T,{"model-value":i(f).length==i(j).length,"onUpdate:modelValue":l[0]||(l[0]=e=>ne(e))},null,8,["model-value"])]),default:t(()=>[s(D,{class:"text-button"},{default:t(()=>[c(" Levels ")]),_:1})]),_:1}),s(te),i(H)?(u(),m("div",xe,[(u(),m(V,null,C(3,e=>s(ae,{color:"primary",type:"list-item",elevation:"0",key:e})),64))])):U("",!0),(u(!0),m(V,null,C(i(j),e=>(u(),_(A,{key:e.value},{append:t(()=>[s(T,{"model-value":i(f).includes(e.value),"onUpdate:modelValue":n=>ie(e,n)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[s(D,null,{default:t(()=>[c(b(e.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(W,{elevation:"0",color:"primary"},{default:t(()=>[s(Y,{class:"pa-0"},{default:t(()=>[s(ee,{"bg-color":"primary",density:"compact"},{default:t(()=>[s(A,null,{append:t(()=>[s(T,{"model-value":i(p).length==i(y).length,"onUpdate:modelValue":l[1]||(l[1]=e=>re(e))},null,8,["model-value"])]),default:t(()=>[s(D,{class:"text-button"},{default:t(()=>[c(" Departments ")]),_:1})]),_:1}),s(te),i(H)?(u(),m("div",Le,[(u(),m(V,null,C(3,e=>s(ae,{color:"primary",type:"list-item",elevation:"0",key:e})),64))])):U("",!0),(u(!0),m(V,null,C(i(y),e=>(u(),_(A,{key:e.pk},{append:t(()=>[s(T,{"model-value":i(p).includes(e.pk),"onUpdate:modelValue":n=>oe(e,n)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[s(D,null,{default:t(()=>[c(b(e.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),s(K,{cols:"12",lg:9,class:"pa-4"},{default:t(()=>[Ue,i(M).length==0?(u(),m("div",Re,[s(Ve,{type:"info",color:"blue lighten-2",dismissible:""},{default:t(()=>[$e,Se,Ae]),_:1})])):U("",!0),s(G,{group:""},{default:t(()=>[s(R,{class:"ma-1",onClick:ce,color:"error",variant:"elevated"},{default:t(()=>[d("div",De,[Q(s(O,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[J,i(N)]]),Te])]),_:1}),(u(!0),m(V,null,C(i(M),e=>(u(),m("div",{class:"d-inline-block ma-1",key:e.pk},[s(F,{location:"top center"},{default:t(()=>[d("div",null,[c(b(e.title)+" offered by ",1),Oe,c(" "+b(e.departments.flatMap(n=>n.code).join(", ")),1)])]),activator:t(({props:n})=>{var L;return[s(R,B(n,{color:(L=i(o))!=null&&L.courses.includes(e.pk)?"primary":"",class:"ma-1",variant:"flat",onClick:k=>q(e),l:""}),{append:t(()=>{var k;return[i($)[e.pk]?(u(),_(O,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):(k=i(o))!=null&&k.courses.includes(e.pk)?(u(),_(I,{key:1,class:"ml-2"},{default:t(()=>[c("mdi-check-all")]),_:1})):U("",!0)]}),default:t(()=>[c(b(e.code)+" ",1)]),_:2},1040,["color","onClick"])]}),_:2},1024)]))),128))]),_:1}),Ee,s(G,{group:""},{default:t(()=>[s(R,{class:"ma-1",onClick:pe,color:"success",variant:"elevated"},{default:t(()=>[d("div",Me,[Q(s(O,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[J,i(P)]]),Ne])]),_:1}),(u(!0),m(V,null,C(i(ue),e=>(u(),m("div",{class:"d-inline-block ma-1",key:e.pk},[s(F,{location:"top center"},{default:t(()=>[d("div",null,[c(b(e.title)+" offered by ",1),Pe,c(" "+b(e.departments.flatMap(n=>n.code).join(", ")),1)])]),activator:t(({props:n})=>{var L;return[s(R,B(n,{color:(L=i(o))!=null&&L.courses.includes(e.pk)?"primary":"",class:"ma-1",variant:"flat",onClick:k=>q(e),l:""}),{append:t(()=>{var k;return[i($)[e.pk]?(u(),_(O,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):(k=i(o))!=null&&k.courses.includes(e.pk)?(u(),_(I,{key:1,class:"ml-2"},{default:t(()=>[c("mdi-check-all")]),_:1})):U("",!0)]}),default:t(()=>[c(b(e.code)+" ",1)]),_:2},1040,["color","onClick"])]}),_:2},1024)]))),128)),d("div",ze,[s(F,{location:"top center"},{default:t(()=>[Be]),activator:t(({props:e})=>[s(R,B(e,{color:"teal",class:"ma-1",variant:"flat",onClick:l[2]||(l[2]=n=>x.value=!0)}),{append:t(()=>[s(I,{class:"ml-2"},{default:t(()=>[c("mdi-plus")]),_:1})]),default:t(()=>[c("new course ")]),_:2},1040),s(Ce,{persistent:"","max-width":"560",modelValue:i(x),"onUpdate:modelValue":l[4]||(l[4]=n=>_e(x)?x.value=n:null)},{default:t(()=>[s(r,{onAdd:fe,onClose:l[3]||(l[3]=n=>x.value=!1)})]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ut as default};
