import{n as Y,q as ne,v as A,r as C,J as X,o as m,c as R,b as t,w as e,L as Z,z as o,y as V,D as oe,a as g,A as de,Q as q,$ as H,a0 as J,T as ee,at as te,d as c,Z as G,C as E,B as O,a2 as ce,a1 as me,t as P,ag as pe}from"./entry.tQWHpBLf.js";import{V as K}from"./VMenu.CmTKH41A.js";import{V as fe}from"./VDialog.SCbeIy52.js";import{u as M}from"./view.TfeFt1aZ.js";import{u as I}from"./use-notification.Rdal1ke4.js";import{u as _e}from"./useSlotCourse.xKZgOLu0.js";import{u as se}from"./use-fetch-header.3DHnPbz-.js";import{u as ie}from"./use-logger.h09id-NO.js";import{V as W}from"./VChip.ttJWPZTa.js";import{V as U}from"./VProgressCircular.DTBbBXDU.js";import{V as ve,a as z}from"./VList.lljtylUW.js";import{V as L}from"./index.AmeJTHgO.js";import{V as ge,b as be}from"./VCard.T8BHTP73.js";import{V as le}from"./VAutocomplete.6WsM3riW.js";import{V as ye}from"./VBtn._oQ1uiNP.js";import{V as Ve}from"./VDivider.KeqwIEcH.js";import{u as Ce}from"./fetch.EGa3nfvI.js";import{a as Q,V as re}from"./VRow.WlLBb9Jc.js";import{V as he}from"./VAvatar.NX62-iRj.js";import"./VOverlay.1V9m9YmJ.js";import"./easing.imumzmxr.js";import"./lazy.hsVx4m50.js";import"./transition.31NosCAE.js";import"./forwardRefs.y8pOSn8h.js";import"./dialog-transition.OyYDh7J5.js";import"./index.qvKOBlyP.js";import"./VContainer.HgjfEFlY.js";import"./ssrBoot.0aXw1rzb.js";import"./createSimpleFunctional.413Od-xt.js";import"./VSelect.4u-stGGs.js";import"./VTextField.6LPIlZmm.js";import"./VInput.AAxW8xuy.js";import"./VCheckboxBtn.ztQGvB4X.js";import"./filter.y4xAiLA_.js";const we=H(()=>J(()=>import("./timetable_slot_course__full_view.oDKuKUzq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url).then(r=>r.default||r)),Se=H(()=>J(()=>import("./timetable_slot_course__mini_view.3hpGsVcQ.js"),__vite__mapDeps([32,1,2,20,21,4,5,22,7,8,23,24,25,9,10,11,26,29,30,13,14,15,16,17,18,19]),import.meta.url).then(r=>r.default||r)),ke=H(()=>J(()=>import("./slot_course__menu.Eet2BtrH.js"),__vite__mapDeps([33,1,2,34,35,36,37,38,21,39,4,5,40,10,7,8,6,9,11,27,28,41,20,22,23,24,25,26,42,14,15,16,17,18,43,44,3,12,45,46,47,48,49,50,51,52,29,30,53,54,13,19]),import.meta.url).then(r=>r.default||r)),Te=H(()=>J(()=>import("./edit_timetable__slot_course.tUbnfhRL.js"),__vite__mapDeps([55,1,2,56,57,35,37,36,21,4,5,23,24,22,7,8,25,58,59,60,3,6,9,10,11,12,61,20,26,27,28,62,47,48,18,63,45,46,15,49,39,40,41,43,42,14,16,17,44,50,51,52,64,65,53,54,66,67]),import.meta.url).then(r=>r.default||r)),$e=Y({__name:"timetable_slot_course",props:{slotCourse:{},fullView:{type:Boolean},timetable:{},timetableSlot:{},adjacentCourses:{}},emits:["update"],setup(r,{emit:a}){const n=r,i=ne(),u=A(()=>{const l={};n.slotCourse.venues.length<1?l.venue="No venue was asigned":n.slotCourse.invigilators.length<n.slotCourse.venues.length&&(l.invigilators=!0);const d=n.adjacentCourses.filter(y=>{if(y.course.level!=n.slotCourse.course.level)return!1;const j=y.course.departments.map(s=>s.pk);return n.slotCourse.course.departments.map(s=>s.pk).filter(s=>j.includes(s)).length>0});return d.length>0&&(l.confict=d),l}),k=A(()=>{let l=0;const d=u.value;return d.venue&&(l=l+1),d.confict&&(l=l+1),d.invigilators&&(l=l+1),l}),h=A(()=>i.isStudent.value||k.value<1?"success":u.value.confict?"error":"warning"),p=a,b=C(!1),w=C([]),T=A(()=>w.value.includes(!0)),x=X("refres-day-slots");function v(l){p("update",l),D()}function D(){x&&x()}function $(){b.value=!0}return(l,d)=>{const y=we,j=Se,B=ke,N=Te;return m(),R(q,null,[t(K,{location:"bottom","close-on-content-click":!1},{activator:e(({props:s})=>[g("div",Z({class:"ma-1"},s),[l.fullView?(m(),V(y,{key:0,"slot-course":l.slotCourse,"error-color":o(h)},null,8,["slot-course","error-color"])):oe("",!0),l.fullView?oe("",!0):(m(),V(j,{key:1,"slot-course":l.slotCourse,color:o(h),processing:o(T)},null,8,["slot-course","color","processing"]))],16)]),default:e(()=>[t(B,{"slot-course":l.slotCourse,errors:o(u),"error-count":o(k),timetable:l.timetable,onRefresh:D,onEdit:$,onLoading:d[0]||(d[0]=s=>w.value=s)},null,8,["slot-course","errors","error-count","timetable"])]),_:1}),t(fe,{modelValue:o(b),"onUpdate:modelValue":d[2]||(d[2]=s=>de(b)?b.value=s:null),scrollable:"",width:800,height:"100%",persistent:""},{default:e(()=>[t(N,{"slot-course":l.slotCourse,timetable:l.timetable,"timetable-slot":l.timetableSlot,onClose:d[1]||(d[1]=s=>b.value=!1),onUpdate:v},null,8,["slot-course","timetable","timetable-slot"])]),_:1},8,["modelValue"])],64)}}});async function Ie(r,a,n,i){try{a.value=!0,await $fetch(`slots/${r}/auto_assign_venues/`,{baseURL:ee().public.baseURL,method:"POST",headers:se([])}),a.value=!1,i&&i()}catch(u){ie().error("useTimetableSlot","Could not assign venues",u),n.value=u}finally{a.value=!1}}function Le(r,a){const n=C(!1),i=C();return{pending:n,error:i,execute:u=>{Ie(u.pk,n,i,a)}}}async function Ae(r,a,n,i){try{a.value=!0,await $fetch(`slots/${r}/auto_assign_invigilators/`,{baseURL:ee().public.baseURL,headers:se([]),method:"POST"}),a.value=!1,i&&i()}catch(u){ie().error("useTimetableSlot","Could not assign venues",u),n.value=u}finally{a.value=!1}}function Re(r,a){const n=C(!1),i=C();return{pending:n,error:i,execute:u=>{Ae(u.pk,n,i,a)}}}const ae=()=>({assignVenues:Le,assignInvigilators:Re}),De={key:2,class:te({"d-flex flex-wrap":!0})},je={class:"d-flex flex-wrap py-2"},ze={class:"d-flex"},Ue=g("span",{class:"pl-2"},"Add Course",-1),Ee=Y({__name:"timetable__slot_view",props:{daySlot:{},fullView:{type:Boolean},pending:{type:Boolean}},setup(r){const a=r,n=ne(),i=X(M().currentTimetableInjectSymbol),u=X("refres-day-slots"),{showSlotCourse:k}=M(),h=A(()=>a.daySlot?a.daySlot.courses.filter(k).sort((s,f)=>s.course.student_count-f.course.student_count).reverse():[]),{courses:p,pending:b,refresh:w}=M().getTimetableUnassingedCourses(i.value.pk),{data:T,pending:x}=M().getTimetableStaffs(i.value.pk,{default(){return[]},onError(s){s.statusCode?I().add({title:"Oops",text:"Could not load staff list for timetable",icon:"mdi-alert",closable:!0}):I().add({title:"Oops",text:"Could not load staff list for timetable",icon:"mdi-alert",closable:!0})}}),v=C({}),D=A(()=>!v.value.course||!v.value.supervisor),$=C(!1);async function l(){if(!D.value)try{const s=await _e().addCourseSlot(v.value.course,v.value.supervisor,a.daySlot.pk);w(),u&&u(),I().add({title:`${s.course.code} Added`,text:`${s.course.title} (${s.course.code}) was added to the timetable`,icon:"mdi-plus",color:"teal",closable:!0})}catch(s){const f=s;if(!f.statusCode)I().postNetowrkIssue();else switch(f.statusCode){case 404:I().add({title:"Oops",text:"Timetable could not be found",color:"amber",icon:"mdi-alert"});break;default:I().postServerIssue();break}}finally{$.value=!1}}const{execute:d,pending:y}=ae().assignVenues(a.daySlot,u),{execute:j,pending:B}=ae().assignInvigilators(a.daySlot,u);async function N(){}return(s,f)=>{const ue=$e;return m(),V(K,{location:"right center",offset:-25,"close-on-content-click":!1,disabled:!o(n).isAdmin.value},{activator:e(({props:_})=>[g("div",Z(_,{class:["w-100 h-100 pa-2",{"not-empty":o(h).length>0}]}),[!s.daySlot||s.daySlot.courses.length<1?(m(),R("div",{key:0,class:te(["w-100 d-flex align-center justify-center",{" flex-column":s.fullView}])},[t(W,{class:"pa-2 mb-2",variant:"tonal",color:"warning"},{default:e(()=>[c("No Course")]),_:1})],2)):s.pending?(m(),V(U,{key:1})):(m(),R("div",De,[(m(!0),R(q,null,G(o(h),S=>(m(),V(ue,{key:S.course.pk,"slot-course":S,"full-view":s.fullView,timetable:o(i),"timetable-slot":s.daySlot,"adjacent-courses":s.daySlot.courses.filter(F=>F!=S)},null,8,["slot-course","full-view","timetable","timetable-slot","adjacent-courses"]))),128))]))],16)]),default:e(()=>[t(ve,{class:"py-0"},{default:e(()=>[t(K,{location:"right center","close-on-content-click":!1},{activator:e(({props:_})=>[t(z,Z(_,{disabled:o($)}),{append:e(()=>[t(L,null,{default:e(()=>[c("mdi-plus")]),_:1})]),prepend:e(()=>[O(t(U,{indeterminate:"",size:"20",class:"mr-2"},null,512),[[E,o($)]])]),default:e(()=>[c(" Add Course ")]),_:2},1040,["disabled"])]),default:e(()=>[t(ge,{width:"400",class:"mx-2"},{default:e(()=>[t(be,null,{default:e(()=>[t(le,{label:"Course",items:o(p),"item-title":"title","item-value":"pk",loading:o(b),modelValue:o(v).course,"onUpdate:modelValue":f[0]||(f[0]=_=>o(v).course=_),"append-inner-icon":"mdi-refresh","onClick:appendInner":o(w)},{item:e(({props:_,item:S})=>[t(z,me(ce(_)),{title:e(()=>[c(P(S.raw.title)+" ("+P(S.raw.code)+") ",1)]),subtitle:e(()=>[g("div",je,[(m(!0),R(q,null,G(S.raw.departments,F=>(m(),V(W,{key:F.pk,class:"mr-1"},{default:e(()=>[c(P(F.code),1)]),_:2},1024))),128))])]),_:2},1040)]),_:1},8,["items","loading","modelValue","onClick:appendInner"]),t(le,{label:"Supervisor",items:o(T),loading:o(x),"item-title":"name","item-value":"pk",modelValue:o(v).supervisor,"onUpdate:modelValue":f[1]||(f[1]=_=>o(v).supervisor=_)},null,8,["items","loading","modelValue"]),g("div",ze,[t(ye,{onClick:l,color:"primary",disabled:o(D),loading:o($)},{default:e(()=>[t(L,null,{default:e(()=>[c("mdi-plus")]),_:1}),Ue]),_:1},8,["disabled","loading"])])]),_:1})]),_:1})]),_:1}),t(z,{disabled:o(y),onClick:f[2]||(f[2]=_=>o(d)(s.daySlot))},{append:e(()=>[t(L,null,{default:e(()=>[c("mdi-map-marker-check")]),_:1})]),prepend:e(()=>[O(t(U,{indeterminate:"",size:"20",class:"mr-2"},null,512),[[E,o(y)]])]),default:e(()=>[c(" Assign Venues ")]),_:1},8,["disabled"]),t(z,{disabled:o(y),onClick:f[3]||(f[3]=_=>o(j)(s.daySlot))},{append:e(()=>[t(L,null,{default:e(()=>[c("mdi-account-group")]),_:1})]),prepend:e(()=>[O(t(U,{indeterminate:"",size:"20",class:"mr-2"},null,512),[[E,o(B)]])]),default:e(()=>[c(" Assign Invigilators ")]),_:1},8,["disabled"]),t(Ve),t(z,{onClick:N},{append:e(()=>[t(L,{color:"error"},{default:e(()=>[c("mdi-close-box")]),_:1})]),title:e(()=>[c("Clear courses")]),subtitle:e(()=>[c(" This will remove all courses in this slot ")]),_:1})]),_:1})]),_:1},8,["disabled"])}}}),Oe={class:"d-flex justify-space-between"},Pe={class:"d-flex flex-column justify-center justify-center"},xe={class:"pa-2 text-center"},Vt=Y({__name:"timetable__day_view",props:{timetable:{},day:{},fullView:{type:Boolean},date:{}},setup(r){const a=r,{data:n,pending:i,error:u,refresh:k}=Ce(`/timetables/${a.timetable.pk}/day_slots/?day=${a.day}`,{baseURL:ee().public.baseURL,headers:se([]),retry:5,retryDelay:1e3,cache:"default",default(){return[]}},"$COvcdORX5F");pe("refres-day-slots",k);function h(p){if(!(n.value.length<p))return n.value[p]}return(p,b)=>{const w=Ee;return m(),V(re,{class:"my-0","no-gutters":""},{default:e(()=>[t(Q,{class:te(["border d-block pa-2 flex-column d-flex align-center justify-center",{sticky:!0}]),lg:p.fullView?12:2,sm:12},{default:e(()=>[g("div",Oe,[g("div",Pe,[g("span",xe,"Day "+P(a.day),1),g("span",null,P(p.date.toString().split("-").reverse().join("/")),1)]),O(t(U,{indeterminate:""},null,512),[[E,o(i)]])]),O(t(W,{color:"red",class:"ma-1"},{default:e(()=>[t(he,null,{default:e(()=>[t(L,null,{default:e(()=>[c("mdi-network-off")]),_:1})]),_:1}),c(" Error ")]),_:1},512),[[E,o(u)]])]),_:1},8,["lg"]),t(Q,{lg:p.fullView?12:10,cols:12},{default:e(()=>[t(re,{"no-gutters":"",justify:"space-evenly",align:"stretch",class:"h-100"},{default:e(()=>[(m(!0),R(q,null,G(p.timetable.slot_per_day,T=>(m(),V(Q,{class:"border pa-1 flex-1",key:T},{default:e(()=>[t(w,{timetable:p.timetable,"day-slot":h(T-1),"full-view":p.fullView,pending:o(i)},null,8,["timetable","day-slot","full-view","pending"])]),_:2},1024))),128))]),_:1})]),_:1},8,["lg"])]),_:1})}}});export{Vt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./timetable_slot_course__full_view.oDKuKUzq.js","./entry.tQWHpBLf.js","./entry.JkaK1PbT.css","./VCard.T8BHTP73.js","./VRow.WlLBb9Jc.js","./VRow.Jj_ITn01.css","./createSimpleFunctional.413Od-xt.js","./index.AmeJTHgO.js","./index.RLmRraAs.css","./VAvatar.NX62-iRj.js","./transition.31NosCAE.js","./VAvatar.Y9acgeJC.css","./VCard.3-GUCx0W.css","./VTooltip.gJvVvmRp.js","./VOverlay.1V9m9YmJ.js","./easing.imumzmxr.js","./lazy.hsVx4m50.js","./VOverlay.XsbusQk2.css","./forwardRefs.y8pOSn8h.js","./VTooltip.oPNLlzwT.css","./VChip.ttJWPZTa.js","./index.qvKOBlyP.js","./VBtn._oQ1uiNP.js","./VProgressCircular.DTBbBXDU.js","./VProgressCircular.u2v1YYMj.css","./VBtn.Y_2JgC81.css","./VChip.y9TZEtu3.css","./VDivider.KeqwIEcH.js","./VDivider.8k_-HhJN.css","./VBadge.ClXMEkqI.js","./VBadge.RXiHNk7i.css","./timetable_slot_course__full_view.h221uLIF.css","./timetable_slot_course__mini_view.3hpGsVcQ.js","./slot_course__menu.Eet2BtrH.js","./useSlotCourse.xKZgOLu0.js","./use-fetch-header.3DHnPbz-.js","./use-notification.Rdal1ke4.js","./use-logger.h09id-NO.js","./useGlobalView.1_iJaLaV.js","./VList.lljtylUW.js","./ssrBoot.0aXw1rzb.js","./VList.caQDbXay.css","./VMenu.CmTKH41A.js","./dialog-transition.OyYDh7J5.js","./VMenu.d2mYOYiy.css","./VSelect.4u-stGGs.js","./VTextField.6LPIlZmm.js","./VInput.AAxW8xuy.js","./VInput.RlDaFj_L.css","./VTextField.TVPDxnpH.css","./VCheckboxBtn.ztQGvB4X.js","./VCheckboxBtn.ENbCW1_T.css","./VSelect.VhdMMxMj.css","./VAlert.9L9TAqJu.js","./VAlert.9fEOfC_e.css","./edit_timetable__slot_course.tUbnfhRL.js","./view.TfeFt1aZ.js","./fetch.EGa3nfvI.js","./VContainer.HgjfEFlY.js","./view.BY18__VO.css","./form-validations.GCMU-Axm.js","./VSpacer.t62wCS3Z.js","./VForm.Y4-k9QxA.js","./VAutocomplete.6WsM3riW.js","./filter.y4xAiLA_.js","./VAutocomplete.smHtj5vg.css","./VCheckbox.SuWXhtYw.js","./VCheckbox.Flv8K2j6.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}