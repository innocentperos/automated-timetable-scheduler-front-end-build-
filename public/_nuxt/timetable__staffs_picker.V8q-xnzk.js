import{_ as oe}from"./add_staff.vue.Lrt-nJug.js";import{n as re,h as ie,r as g,v as T,o as n,y as V,w as e,z as i,L as S,b as s,d as p,Q as L,Z as R,c as f,D as P,t as v,C as B,B as z,a as c,A as ne,T as de,x as U}from"./entry.tQWHpBLf.js";import{u as ue}from"./timetables-store.awZnM9r_.js";import{u as F}from"./fetch.EGa3nfvI.js";import{u as _}from"./use-fetch-header.3DHnPbz-.js";import{u as m}from"./use-notification.Rdal1ke4.js";import{V as M}from"./index.qvKOBlyP.js";import{V as ce,a as I}from"./VRow.WlLBb9Jc.js";import{V as me,b as pe}from"./VCard.T8BHTP73.js";import{V as fe,a as j,b as Q}from"./VList.lljtylUW.js";import{V as $}from"./VTooltip.gJvVvmRp.js";import{V as H}from"./VCheckboxBtn.ztQGvB4X.js";import{V as ve}from"./VDivider.KeqwIEcH.js";import{V as be}from"./VSkeletonLoader.bS24LWfm.js";import{V as w}from"./VProgressCircular.DTBbBXDU.js";import{V as C}from"./VChip.ttJWPZTa.js";import{V as X}from"./index.AmeJTHgO.js";import{V as ke}from"./VDialog.SCbeIy52.js";import{V as he}from"./VContainer.HgjfEFlY.js";import"./use-logger.h09id-NO.js";import"./form-validations.GCMU-Axm.js";import"./VCheckbox.SuWXhtYw.js";import"./VInput.AAxW8xuy.js";import"./transition.31NosCAE.js";import"./VTextField.6LPIlZmm.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./VAvatar.NX62-iRj.js";import"./VSelect.4u-stGGs.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./VBtn._oQ1uiNP.js";import"./VForm.Y4-k9QxA.js";import"./createSimpleFunctional.413Od-xt.js";import"./ssrBoot.0aXw1rzb.js";const _e={key:0,class:"d-flex flex-column"},ye=c("div",{class:"d-block mx-4 mt-4 mb-2"},"Selected Staff",-1),ge={class:"d-flex justify-center align-center"},Ve=c("span",null,"Remove All Staffs",-1),we=c("div",{class:"d-block ma-4 mb-1"},"Staff Pool",-1),Ce={class:"d-flex justify-center align-center"},xe=c("span",null,"Add All Staffs",-1),Se={class:"d-block ma-1",key:"add-course"},Le=c("div",null,"Add a new staff",-1),mt=re({__name:"timetable__staffs_picker",props:{tablePk:{}},setup(Y){const Z=Y,b=de(),r=ue().retrieve(Z.tablePk),{data:k,pending:q}=F("/departments/",{baseURL:b.public.baseURL,headers:_([]),default(){return[]}},"$TA7MoCQ7bf");ie([k],()=>{k.value.length>0&&u.value.length<=0&&(u.value=k.value.map(t=>t.pk))});const u=g([]);function G(t){t?u.value=k.value.map(l=>l.pk):u.value=[]}function J(t,l){l==!1?u.value=u.value.filter(o=>o!=t.pk):u.value.push(t.pk)}const{data:A,pending:K}=F("/staffs/",{baseURL:b.public.baseURL,headers:_([]),default(){return[]}},"$twOFYhntVC"),N=T(()=>A.value.filter(t=>u.value.includes(t.department.pk))),E=T(()=>A.value.filter(t=>{var l;return(l=r.value)==null?void 0:l.staffs.includes(t.pk)})),W=T(()=>N.value.filter(t=>{var l;return!((l=r.value)!=null&&l.staffs.includes(t.pk))})),h=g({});async function ee(t){if(r.value)try{h.value[t.pk]=!0,await $fetch(`/timetables/${r.value.pk}/staffs/`,{baseURL:b.public.baseURL,headers:_([]),method:"delete",body:[t.pk]}),r.value.staffs=r.value.staffs.filter(l=>l!=t.pk)}catch(l){const o=l;if(!o.statusCode)m().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(o.statusCode){case 404:U().push("/time-tables");break;default:m().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{h.value[t.pk]=!1}}async function te(t){if(r.value)try{h.value[t.pk]=!0,await $fetch(`/timetables/${r.value.pk}/staffs/`,{baseURL:b.public.baseURL,headers:_([]),method:"post",body:[t.pk]}),r.value.staffs.push(t.pk)}catch(l){const o=l;if(!o.statusCode)m().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(o.statusCode){case 404:U().push("/time-tables");break;default:m().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{h.value[t.pk]=!1}}const y=g(!1);function ae(t){A.value.push(t),m().add({text:`${t.name} was added to staffs`,icon:"mdi-check-all",color:"teal"})}const D=g(!1);async function le(){var l;const t=E.value.map(o=>o.pk);try{D.value=!0,await $fetch(`/timetables/${(l=r.value)==null?void 0:l.pk}/staffs/`,{method:"DELETE",baseURL:b.public.baseURL,body:t,headers:_([])}),r.value&&(r.value.staffs=r.value.staffs.filter(o=>!t.includes(o)))}catch(o){const a=o;if(!a.statusCode)m().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(a.statusCode){case 404:U().push("/time-tables");break;default:m().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{D.value=!1}}const O=g(!1);async function se(){var l;const t=N.value.map(o=>o.pk);try{O.value=!0,await $fetch(`/timetables/${(l=r.value)==null?void 0:l.pk}/staffs/`,{method:"POST",baseURL:b.public.baseURL,body:t,headers:_([])}),r.value&&(r.value.staffs=[...r.value.staffs,...t])}catch(o){const a=o;if(!a.statusCode)m().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(a.statusCode){case 404:U().push("/time-tables");break;default:m().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{O.value=!1}}return(t,l)=>{const o=oe;return n(),V(he,{fluid:""},{default:e(()=>[s(ce,null,{default:e(()=>[s(I,{cols:"12",lg:"3"},{default:e(()=>[s(me,{elevation:"0",color:"primary"},{default:e(()=>[s(pe,{class:"pa-0"},{default:e(()=>[s(fe,{"bg-color":"primary",density:"compact"},{default:e(()=>[s(j,null,{append:e(()=>[s($,{location:"top center"},{activator:e(({props:a})=>[s(H,S(a,{"model-value":i(u).length==i(k).length,"onUpdate:modelValue":l[0]||(l[0]=d=>G(d))}),null,16,["model-value"])]),default:e(()=>[p(" Select all departments ")]),_:1})]),default:e(()=>[s(Q,{class:"text-button"},{default:e(()=>[p(" Departments ")]),_:1})]),_:1}),s(ve),i(q)?(n(),f("div",_e,[(n(),f(L,null,R(3,a=>s(be,{color:"primary",type:"list-item",elevation:"0",key:a})),64))])):P("",!0),(n(!0),f(L,null,R(i(k),a=>(n(),V(j,{key:a.pk},{append:e(()=>[s(H,{"model-value":i(u).includes(a.pk),"onUpdate:modelValue":d=>J(a,d)},null,8,["model-value","onUpdate:modelValue"])]),default:e(()=>[s(Q,null,{default:e(()=>[p(v(a.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),s(I,{cols:"12",lg:"9"},{default:e(()=>[ye,z(s(w,null,null,512),[[B,i(K)]]),s(M,{group:""},{default:e(()=>[s(C,{class:"ma-1",onClick:le,color:"error",variant:"elevated"},{default:e(()=>[c("div",ge,[z(s(w,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[B,i(D)]]),Ve])]),_:1}),(n(!0),f(L,null,R(i(E),a=>(n(),f("div",{class:"d-inline-block ma-1",key:a.pk},[s($,{location:"top center"},{activator:e(({props:d})=>[s(C,S(d,{color:"primary",class:"ma-1",variant:"flat",onClick:x=>ee(a)}),{append:e(()=>{var x;return[i(h)[a.pk]?(n(),V(w,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):(x=i(r))!=null&&x.staffs.includes(a.pk)?(n(),V(X,{key:1,class:"ml-2"},{default:e(()=>[p("mdi-check-all")]),_:1})):P("",!0)]}),default:e(()=>[p(v(a.name)+" ",1)]),_:2},1040,["onClick"])]),default:e(()=>[c("div",null,v(a.name)+", with a maximum capacity of",1)]),_:2},1024)]))),128))]),_:1}),we,s(M,{group:""},{default:e(()=>[s(C,{class:"ma-1",onClick:se,color:"error",variant:"elevated"},{default:e(()=>[c("div",Ce,[z(s(w,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[B,i(O)]]),xe])]),_:1}),(n(!0),f(L,null,R(i(W),a=>(n(),f("div",{class:"d-inline-block ma-1",key:a.pk},[s($,{location:"top center"},{activator:e(({props:d})=>[s(C,S(d,{class:"ma-1",variant:"flat",onClick:x=>te(a)}),{append:e(()=>[i(h)[a.pk]?(n(),V(w,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):P("",!0)]),default:e(()=>[p(v(a.name)+" ("+v(a.department.code)+") ",1)]),_:2},1040,["onClick"])]),default:e(()=>[c("div",null,v(a.name)+" ("+v(a.department.code)+")",1)]),_:2},1024)]))),128)),c("div",Se,[s($,{location:"top center"},{default:e(()=>[Le]),activator:e(({props:a})=>[s(C,S(a,{color:"teal",class:"ma-1",variant:"flat",onClick:l[1]||(l[1]=d=>y.value=!0)}),{append:e(()=>[s(X,{class:"ml-2"},{default:e(()=>[p("mdi-plus")]),_:1})]),default:e(()=>[p("new staff ")]),_:2},1040),s(ke,{persistent:"","max-width":"560",modelValue:i(y),"onUpdate:modelValue":l[3]||(l[3]=d=>ne(y)?y.value=d:null)},{default:e(()=>[s(o,{onAdd:ae,onClose:l[2]||(l[2]=d=>y.value=!1)})]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{mt as default};
