import{_ as se}from"./add_venue.vue.fS5TvNHf.js";import{n as oe,h as re,r as y,v as D,o as n,y as V,w as a,z as i,L,b as s,c as p,Q as R,Z as U,t as u,d as b,a as m,C as N,B as z,D as F,A as ie,T as ne,x as $}from"./entry.tQWHpBLf.js";import{u as ue}from"./timetables-store.awZnM9r_.js";import{u as I}from"./fetch.EGa3nfvI.js";import{u as g}from"./use-fetch-header.3DHnPbz-.js";import{u as f}from"./use-notification.Rdal1ke4.js";import{V as M}from"./index.qvKOBlyP.js";import{V as ce,a as j}from"./VRow.WlLBb9Jc.js";import{V as de,b as me}from"./VCard.T8BHTP73.js";import{V as pe,a as H}from"./VList.lljtylUW.js";import{V as S}from"./VTooltip.gJvVvmRp.js";import{V as Q}from"./VCheckboxBtn.ztQGvB4X.js";import{V as fe}from"./VDivider.KeqwIEcH.js";import{V as ve}from"./VSkeletonLoader.bS24LWfm.js";import{V as C}from"./VChip.ttJWPZTa.js";import{V as O}from"./VProgressCircular.DTBbBXDU.js";import{V as W}from"./index.AmeJTHgO.js";import{V as he}from"./VDialog.SCbeIy52.js";import{V as ke}from"./VContainer.HgjfEFlY.js";import"./use-logger.h09id-NO.js";import"./form-validations.GCMU-Axm.js";import"./VTextField.6LPIlZmm.js";import"./transition.31NosCAE.js";import"./VInput.AAxW8xuy.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./VAvatar.NX62-iRj.js";import"./VSelect.4u-stGGs.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./VBtn._oQ1uiNP.js";import"./VForm.Y4-k9QxA.js";import"./createSimpleFunctional.413Od-xt.js";import"./ssrBoot.0aXw1rzb.js";const be=m("span",{class:"text-uppercase"},"Categories",-1),ge={key:0},_e={key:1},ye={key:0,class:"d-flex flex-column"},Ve={class:"d-block mx-4 mt-4 mb-2"},Ce={class:"d-flex justify-center align-center"},we=m("span",null,"Remove All Venue",-1),xe={class:"d-block ma-4 mb-1"},Le={class:"d-flex justify-center align-center"},Re=m("span",null,"Add All Venues",-1),Ue={class:"d-block ma-1",key:"add-course"},$e=m("div",null,"Add a new venue",-1),mt=oe({__name:"timetable__venues_picker",props:{tablePk:{}},setup(X){const h=ne(),Z=X,r=ue().retrieve(Z.tablePk),{data:v,pending:q}=I("/venues/categories/",{baseURL:h.public.baseURL,headers:g([]),default(){return[]}},"$B3VcfNCkv6");re([v],()=>{v.value.length>0&&c.value.length<=0&&(c.value=v.value.map(e=>e.pk))});const c=y([]);function G(e,l){l==!1?c.value=c.value.filter(o=>o!=e.pk):c.value.push(e.pk)}function J(e){return c.value.includes(e.pk)}function K(e){e?c.value=v.value.map(l=>l.pk):c.value=[]}const{data:w}=I("/venues/",{baseURL:h.public.baseURL,headers:g([]),default(){return[]}},"$g21tIsVFWN"),E=D(()=>c.value.length==0?w.value:w.value.filter(e=>e.category?c.value.includes(e.category.pk):!1)),T=D(()=>w.value.filter(e=>{var l;return(l=r.value)==null?void 0:l.venues.includes(e.pk)})),A=D(()=>r?E.value.filter(e=>!r.value.venues.includes(e.pk)):E.value),k=y({});async function Y(e){try{k.value[e.pk]=!0,await $fetch(`/timetables/${r.value.pk}/venues/`,{method:"DELETE",baseURL:h.public.baseURL,headers:g([]),body:[e.pk]}),r.value&&(r.value.venues=r.value.venues.filter(l=>l!=e.pk))}catch(l){const o=l;if(!o.statusCode)f().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(o.statusCode){case 404:$().push("/time-tables");break;default:f().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{k.value[e.pk]=!1}}async function ee(e){try{k.value[e.pk]=!0,await $fetch(`/timetables/${r.value.pk}/venues/`,{method:"POST",baseURL:h.public.baseURL,headers:g([]),body:[e.pk]}),r.value.venues.push(e.pk)}catch(l){console.log(l);const o=l;if(!o.statusCode)f().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(o.statusCode){case 404:$().push("/time-tables");break;default:f().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{k.value[e.pk]=!1}}const _=y(!1);function te(e){w.value.push(e),f().add({text:`${e.title} added to venues`,icon:"mdi-check-all",color:"teal",closable:!0})}const P=y(!1);async function ae(){var l;const e=T.value.map(o=>o.pk);try{P.value=!0,await $fetch(`/timetables/${(l=r.value)==null?void 0:l.pk}/venues/`,{method:"DELETE",baseURL:h.public.baseURL,body:e,headers:g([])}),r.value&&(r.value.venues=r.value.venues.filter(o=>!e.includes(o)))}catch(o){const t=o;if(!t.statusCode)f().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(t.statusCode){case 404:$().push("/time-tables");break;default:f().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{P.value=!1}}const B=y(!1);async function le(){var l;const e=A.value.map(o=>o.pk);try{B.value=!0,await $fetch(`/timetables/${(l=r.value)==null?void 0:l.pk}/venues/`,{method:"POST",baseURL:h.public.baseURL,body:e,headers:g([])}),r.value&&(r.value.venues=[...r.value.venues,...e])}catch(o){const t=o;if(!t.statusCode)f().add({text:"Oops, make sure you have a stable internet connection and try again.",icon:"mdi-wifi-remove",closable:!0});else switch(t.statusCode){case 404:$().push("/time-tables");break;default:f().add({text:"Oops, something went wrong on the server and try again.",icon:"mdi-server-remove",closable:!0})}}finally{B.value=!1}}return(e,l)=>{const o=se;return n(),V(ke,{fluid:""},{default:a(()=>[s(ce,null,{default:a(()=>[s(j,{lg:"3",cols:"12",color:"primary"},{default:a(()=>[s(de,null,{default:a(()=>[s(me,{class:"pa-0"},{default:a(()=>[s(pe,{"bg-color":"primary"},{default:a(()=>[s(H,null,{append:a(()=>[s(S,{location:"top center"},{activator:a(({props:t})=>[s(Q,L(t,{"model-value":i(c).length==i(v).length,"onUpdate:modelValue":l[0]||(l[0]=d=>K(d))}),null,16,["model-value"])]),default:a(()=>[i(c).length<i(v).length?(n(),p("span",ge,"Select all categories")):(n(),p("span",_e,"unselect all categories"))]),_:1})]),default:a(()=>[be]),_:1}),s(fe),i(q)?(n(),p("div",ye,[(n(),p(R,null,U(3,t=>s(ve,{color:"primary",type:"list-item",elevation:"0",key:t})),64))])):(n(!0),p(R,{key:1},U(i(v),t=>(n(),V(H,{key:t.pk},{append:a(()=>[s(Q,{"model-value":J(t),"onUpdate:modelValue":d=>G(t,d)},null,8,["model-value","onUpdate:modelValue"])]),default:a(()=>[b(u(t.title)+" ",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),s(j,{cols:"12",lg:"9"},{default:a(()=>[m("div",Ve," Selected Venues "+u(i(T).length),1),s(M,{group:""},{default:a(()=>[s(C,{class:"ma-1",onClick:ae,color:"error",variant:"elevated"},{default:a(()=>[m("div",Ce,[z(s(O,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[N,i(P)]]),we])]),_:1}),(n(!0),p(R,null,U(i(T),t=>(n(),p("div",{class:"d-inline-block ma-1",key:t.pk},[s(S,{location:"top center"},{activator:a(({props:d})=>[s(C,L(d,{color:"primary",class:"ma-1",variant:"flat",onClick:x=>Y(t)}),{append:a(()=>{var x;return[i(k)[t.pk]?(n(),V(O,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):(x=i(r))!=null&&x.venues.includes(t.pk)?(n(),V(W,{key:1,class:"ml-2"},{default:a(()=>[b("mdi-check-all")]),_:1})):F("",!0)]}),default:a(()=>[b(u(t.title)+" ("+u(t.code)+") - "+u(t.capacity)+" ",1)]),_:2},1040,["onClick"])]),default:a(()=>[m("div",null,u(t.category.title)+", with a maximum capacity of "+u(t.capacity),1)]),_:2},1024)]))),128))]),_:1}),m("div",xe,"Venue Pool "+u(i(A).length),1),s(M,{group:""},{default:a(()=>[s(C,{class:"ma-1",onClick:le,color:"error",variant:"elevated"},{default:a(()=>[m("div",Le,[z(s(O,{indeterminate:"",size:"16",width:"2",class:"mr-2"},null,512),[[N,i(B)]]),Re])]),_:1}),(n(!0),p(R,null,U(i(A),t=>(n(),p("div",{class:"d-inline-block ma-1",key:t.pk},[s(S,{location:"top center"},{activator:a(({props:d})=>[s(C,L(d,{class:"ma-1",variant:"flat",onClick:x=>ee(t)}),{append:a(()=>[i(k)[t.pk]?(n(),V(O,{key:0,size:"x-small",class:"ml-2",indeterminate:""})):F("",!0)]),default:a(()=>[b(u(t.title)+" ("+u(t.code)+") - "+u(t.capacity)+" ",1)]),_:2},1040,["onClick"])]),default:a(()=>[m("div",null,u(t.category.title)+", with a maximum capacity of "+u(t.capacity),1)]),_:2},1024)]))),128)),m("div",Ue,[s(S,{location:"top center"},{default:a(()=>[$e]),activator:a(({props:t})=>[s(C,L(t,{color:"teal",class:"ma-1",variant:"flat",onClick:l[1]||(l[1]=d=>_.value=!0)}),{append:a(()=>[s(W,{class:"ml-2"},{default:a(()=>[b("mdi-plus")]),_:1})]),default:a(()=>[b("new venue ")]),_:2},1040),s(he,{persistent:"","max-width":"560",modelValue:i(_),"onUpdate:modelValue":l[3]||(l[3]=d=>ie(_)?_.value=d:null)},{default:a(()=>[s(o,{onAdd:te,onClose:l[2]||(l[2]=d=>_.value=!1)})]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{mt as default};
