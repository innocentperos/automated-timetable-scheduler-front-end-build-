import{n as H,r,v as O,o as L,y as N,w as s,d as g,b as l,z as t,A as u,D as P,R as Q,T as X}from"./entry.tQWHpBLf.js";import{u as Z}from"./fetch.EGa3nfvI.js";import{u as j}from"./use-fetch-header.3DHnPbz-.js";import{u as T}from"./use-logger.h09id-NO.js";import{u as b}from"./use-notification.Rdal1ke4.js";import{a as y,b as q}from"./form-validations.GCMU-Axm.js";import{V as x}from"./index.qvKOBlyP.js";import{V as J,a as K,b as W,c as Y}from"./VCard.T8BHTP73.js";import{V as ee,a as p}from"./VRow.WlLBb9Jc.js";import{V as F}from"./VTextField.6LPIlZmm.js";import{V as ae}from"./VSelect.4u-stGGs.js";import{V as M}from"./VCheckbox.SuWXhtYw.js";import{V as k}from"./VBtn._oQ1uiNP.js";import{V as le}from"./VForm.Y4-k9QxA.js";import"./createSimpleFunctional.413Od-xt.js";import"./index.AmeJTHgO.js";import"./VAvatar.NX62-iRj.js";import"./transition.31NosCAE.js";import"./VInput.AAxW8xuy.js";import"./easing.imumzmxr.js";import"./forwardRefs.y8pOSn8h.js";import"./VList.lljtylUW.js";import"./ssrBoot.0aXw1rzb.js";import"./VDivider.KeqwIEcH.js";import"./dialog-transition.OyYDh7J5.js";import"./VMenu.CmTKH41A.js";import"./VOverlay.1V9m9YmJ.js";import"./lazy.hsVx4m50.js";import"./VProgressCircular.DTBbBXDU.js";import"./VCheckboxBtn.ztQGvB4X.js";import"./VChip.ttJWPZTa.js";const Ee=H({__name:"update-staff-modal",props:{staff:{}},emits:["close","update"],setup(D,{emit:E}){const U=X(),i=D,n=r(i.staff.name),d=r(i.staff.staff_id),m=r(i.staff.department.pk),c=r(i.staff.can_supervise),V=r(i.staff.can_invigilate),f=r(!1),{data:I,pending:_}=Z("/departments/",{baseURL:U.public.baseURL,default:()=>[]},"$ZV2GNsnt4Q"),S=E,v=r(!1);async function B(){if(!v.value)return;const e=new FormData;e.append("name",n.value),e.append("staff_id",d.value),e.append("department",m.value.toString()),e.append("can_invigilate",V.value?"true":"false"),e.append("can_supervise",c.value?"true":"false"),e.append("email",$.value);try{f.value=!0;const a=await $fetch(`/staffs/${i.staff.pk}/`,{baseURL:U.public.baseURL,method:"PUT",headers:j([]),body:e});S("update",a),h()}catch(a){const o=a;if(T().error("Update Staff Dialog","Unable to update staff",o),o.statusCode)switch(o.statusCode){case 400:b().add({title:"Form error",text:"The values you provided in the form was invalid",icon:"mdi-page-layout-header",action(C){C()}});break;case 409:b().add({title:"Staff Id Conflict",text:"Seems there is another staff with thesame staff id",icon:"mdi-page-layout-header",color:"error",action(C){C()}});break;default:b().postServerIssue();break}else b().postNetowrkIssue()}finally{f.value=!1}}function h(){n.value="",d.value="",m.value=0,f.value=!1,S("close")}const w=r(!1),$=r(""),R=r(!1),A=r(!1),z=O(()=>!!(w.value==!1||A.value));async function G(){try{R.value=!0}catch(e){T().error("ConfirmEmail","COuld not confrim staff email",e)}finally{R.value=!1}}return(e,a)=>(L(),N(le,{onSubmit:a[5]||(a[5]=Q(()=>{},["prevent"])),modelValue:t(v),"onUpdate:modelValue":a[6]||(a[6]=o=>u(v)?v.value=o:null),disabled:t(f)},{default:s(()=>[l(J,null,{default:s(()=>[l(K,{"primary-title":"",class:"px-6 pt-6"},{default:s(()=>[g(" Update staff ")]),_:1}),l(W,null,{default:s(()=>[l(ee,null,{default:s(()=>[l(p,{cols:"8"},{default:s(()=>[l(F,{name:"Name",label:"Name",id:"name",modelValue:t(n),"onUpdate:modelValue":a[0]||(a[0]=o=>u(n)?n.value=o:null),rules:["useRuleRequired"in e?e.useRuleRequired:t(y),("useRuleMinLength"in e?e.useRuleMinLength:t(q))(3)]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"4"},{default:s(()=>[l(F,{name:"staff-id",label:"Staff Id",id:"staff-id",modelValue:t(d),"onUpdate:modelValue":a[1]||(a[1]=o=>u(d)?d.value=o:null),rules:["useRuleRequired"in e?e.useRuleRequired:t(y),("useRuleMinLength"in e?e.useRuleMinLength:t(q))(3)]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(ae,{items:t(I),modelValue:t(m),"onUpdate:modelValue":a[2]||(a[2]=o=>u(m)?m.value=o:null),label:"Department",rules:["useRuleRequired"in e?e.useRuleRequired:t(y)],loading:t(_),"item-value":"pk"},null,8,["items","modelValue","rules","loading"])]),_:1}),l(p,{cols:"6"},{default:s(()=>[l(M,{modelValue:t(c),"onUpdate:modelValue":a[3]||(a[3]=o=>u(c)?c.value=o:null),label:"Can Supervise"},null,8,["modelValue"])]),_:1}),l(p,{cols:"6"},{default:s(()=>[l(M,{modelValue:t(V),"onUpdate:modelValue":a[4]||(a[4]=o=>u(V)?V.value=o:null),label:"Can Invigilate"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Y,null,{default:s(()=>[l(x,{group:""},{default:s(()=>[t(w)?(L(),N(k,{key:0,class:"ml-4",type:"submit",color:"primary",onClick:G,loading:t(R)},{default:s(()=>[g("Validated Email")]),_:1},8,["loading"])):P("",!0),l(k,{class:"ml-4",type:"submit",color:"primary",onClick:B,loading:t(f),disabled:!t(z)},{default:s(()=>[g("Save Staff")]),_:1},8,["loading","disabled"])]),_:1}),l(k,{color:"error",onClick:h},{default:s(()=>[g("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]))}});export{Ee as default};
