import{n as G,r,W as H,c as w,V as W,v as s,T as p,u as se,ag as ue,X as oe,Y as ce,o,b as f,w as u,z as n,y as d,d as x,D as R,Q as N,Z as Q,R as ie,t as fe,$ as F,a0 as B,_ as de}from"./entry.tQWHpBLf.js";import{u as q}from"./fetch.EGa3nfvI.js";import{u as b}from"./use-fetch-header.3DHnPbz-.js";import{u as M}from"./use-logger.h09id-NO.js";import{u as _e}from"./use-notification.Rdal1ke4.js";import{V as me}from"./index.qvKOBlyP.js";import{a as C,V as j}from"./VRow.WlLBb9Jc.js";import{V as ve}from"./VProgressCircular.DTBbBXDU.js";import{V as pe}from"./VBtn._oQ1uiNP.js";import{V as K}from"./index.AmeJTHgO.js";import{V as be}from"./VContainer.HgjfEFlY.js";const ge=G({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(e,{slots:t,attrs:a}){const l=r(!1);return H(()=>{l.value=!0}),c=>{var v;if(l.value)return(v=t.default)==null?void 0:v.call(t);const L=t.fallback||t.placeholder;if(L)return L();const i=c.fallback||c.placeholder||"",_=c.fallbackTag||c.placeholderTag||"span";return w(_,a,i)}}}),S=r([]),E=r([]),$=r([]),{query:ye}=W();function he(e){S.value=e}function we(e){E.value=e}function Ve(e){$.value=e}const Z=r([]);function Te(e){Z.value=e}function Le(e){const t=ye.value.toLowerCase().trim();if(t.length>0&&!e.course.code.toLowerCase().includes(t)&&!e.course.title.toLowerCase().includes(t)||E.value.length>0&&!E.value.includes(e.course.level))return!1;if($.value.length>0){let l=!1;for(const c of e.venues)if($.value.includes(c.pk)){l=!0;break}if(!l)return!1}const a=new Set(e.course.departments);if(a.add(e.course.department),S.value.length>0){let l=!1;for(const c of a)if(S.value.includes(c.pk)){l=!0;break}if(!l)return!1}return!0}const xe=Symbol(),V=r({}),I=r({});function X(e,t){I.value[e]=!0,$fetch(`/timetables/${e}/unassigned_courses/`,{baseURL:p().public.baseURL,retry:5,retryDelay:500,headers:b([])}).then(a=>{V.value[e]=a}).catch(a=>{M().error("useTimetableView","Could not not get timetable unassinged courses",a),t&&t.onError&&t.onError(a)}).finally(()=>{I.value[e]=!1})}function Re(e,t){const a=V.value[e];return(!a||a.length<1||t&&t.refresh)&&(t&&t.default?V.value[e]=t.default():V.value[e]=[],X(e,t)),{courses:s(()=>V.value[e]),pending:s(()=>I.value[e]),refresh:()=>X(e,t)}}const T=r({}),O=r({});function Y(e,t){$fetch(`/timetables/${e}/staffs/`,{baseURL:p().public.baseURL,retry:5,retryDelay:500,headers:b([])}).then(a=>{T.value[e]=a}).catch(a=>{M().error("useTimetableView","Could not not get timetable unassinged staffs",a),t&&t.onError&&t.onError(a)}).finally(()=>{O.value[e]=!1})}function Ce(e,t){return(!T.value[e]||t&&t.refresh)&&(O.value[e]=!0,t&&t.default?T.value[e]=t.default():T.value[e]=[],Y(e,t)),{data:s(()=>T.value[e]),pending:s(()=>O.value[e]),refresh:()=>Y(e,t)}}const U=r({}),D=r({});function Ue(e,t){$fetch(`/timetables/${e}/venues/`,{baseURL:p().public.baseURL,retry:5,retryDelay:500,headers:b([])}).then(a=>{U.value[e]=a}).catch(a=>{M().error("useTimetableView","Could not not get timetable venues",a),t&&t.onError&&t.onError(a)}).finally(()=>{D.value[e]=!1})}function J(e,t){return(!D.value[e]||t&&t.refresh)&&(D.value[e]=!0,t&&t.default?U.value[e]=t.default():U.value[e]=[],Ue(e,t)),{data:s(()=>U.value[e]),pending:s(()=>D.value[e]),refresh:l=>J(l,t)}}const De=function(){return{selectedDepartments:s(()=>S.value),selectedLevels:s(()=>E.value),selectedVenues:s(()=>$.value),setDepartments:he,setLevels:we,setVenues:Ve,setStaffs:Te,selectedStaffs:s(()=>Z.value),showSlotCourse:Le,currentTimetableInjectSymbol:xe,getTimetableUnassingedCourses:Re,getTimetableStaffs:Ce,getTimetableVenues:J}},Se=F(()=>B(()=>import("./timetable__day_view.aWB9z64I.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52]),import.meta.url).then(e=>e.default||e)),Ee=F(()=>B(()=>import("./make_complain.cJcIYdv_.js"),__vite__mapDeps([53,1,2,54,19,20,18,21,23,16,4,5,6,7,8,9,10,11,12,13,14,17,37,33,28,29,38,34,35,51,40,41,42,43,44,31,32,36,3,15,25,26,45,46,22,24,27,30,47,39,48,49,55,56,57,58]),import.meta.url).then(e=>e.default||e)),$e=F(()=>B(()=>import("./navigation_bar.6kAtJ7-T.js"),__vite__mapDeps([59,1,2,60,24,13,6,7,14,25,26,27,61,62,63,20,18,21,64,65,31,23,32,9,33,28,29,34,35,36,66,67,68,8,39,40,41,42,43,5,11,44,12,3,4,10,15,45,46,22,30,47,48,49,37,38,69,70,71,72,73,74,75,57,76,50,51]),import.meta.url).then(e=>e.default||e)),ze={key:1},Ae=G({__name:"view",setup(e){const a=se().params.timetable_pk,{data:l,pending:c}=q(`/timetables/${a}`,{baseURL:p().public.baseURL,headers:b([]),transform(g){return g}},"$sNs8KBQYhs"),{data:L}=q(`/timetables/${a}/dates`,{baseURL:p().public.baseURL,headers:b([]),transform(g){return g},default(){return[]}},"$drU9lGKD4N");ue(De().currentTimetableInjectSymbol,l);const i=r(!1),_=r(!0),v=r(!1),{setQuery:P,addActions:ee,removeActions:te}=W();let k=[];oe(()=>{te(k)}),H(()=>{k=ee([{title:s(()=>i.value?"Minimal View":"Full View"),loading:s(()=>v.value),action(){v.value=!0,setTimeout(()=>{i.value=!i.value,v.value=!1},1e3)}},{title:"Export",icon:"mdi-file-excel",color:"yellow",hidden:s(()=>!l.value),loading:s(()=>z.value),action(){ae()}}]),P("")});const z=r(!1);async function ae(g){if(l.value)try{z.value=!0;const h=await(await fetch(`${p().public.baseURL}/timetables/${l.value.pk}/export/`,{headers:b([])})).blob(),A=window.URL.createObjectURL(h);window.open(A,"Download")}catch(y){console.error(y),_e().add({title:"Export failed",text:"An error occured while exporting the timetable",icon:"mdi-close-circle",closable:!0,color:"error",action(h){h()}})}finally{z.value=!1}}const{mobile:le}=ce();return(g,y)=>{const h=Se,A=ge,ne=Ee,re=$e;return o(),w(N,null,[f(be,{fluid:"",class:"pa-0 ma-0"},{default:u(()=>[n(c)?(o(),d(j,{key:0,align:"center",justify:"center"},{default:u(()=>[f(C,{cols:"auto"},{default:u(()=>[f(ve,{indeterminate:""})]),_:1})]),_:1})):n(l)!=null?(o(),w("div",ze,[n(le)?R("",!0):(o(),d(j,{key:0,class:"bg-primary my-0",style:{top:"64px",position:"sticky","z-index":"30"},"no-gutters":""},{default:u(()=>[n(i)?R("",!0):(o(),d(C,{key:0,class:"text-center border py-4",cols:n(i)?12:2},{default:u(()=>[x(" Days ")]),_:1},8,["cols"])),f(C,{cols:n(i)?12:10},{default:u(()=>[f(j,{"no-gutters":""},{default:u(()=>[(o(!0),w(N,null,Q(n(l).slot_per_day,m=>(o(),d(C,{class:"text-center border py-4 flex align-center justify-center h-100",key:m},{default:u(()=>[x("Slot "+fe(m),1)]),_:2},1024))),128))]),_:1})]),_:1},8,["cols"])]),_:1})),f(A,null,{default:u(()=>[(o(!0),w(N,null,Q(n(l).days_count,m=>(o(),d(h,{timetable:n(l),day:m,date:n(L)[m-1],key:m,"full-view":n(i)},null,8,["timetable","day","date","full-view"]))),128))]),_:1})])):R("",!0),f(pe,{icon:"",size:"large",color:n(_)?"primary":"error",location:"bottom right",position:"fixed",class:"ma-6 on-top",onClick:y[0]||(y[0]=ie(m=>_.value=!n(_),["stop"]))},{default:u(()=>[n(_)?(o(),d(K,{key:0},{default:u(()=>[x(" mdi-menu")]),_:1})):(o(),d(K,{key:1},{default:u(()=>[x(" mdi-close")]),_:1}))]),_:1},8,["color"])]),_:1}),f(ne),f(me,null,{default:u(()=>[n(l)&&!n(_)?(o(),d(re,{key:0,timetable:n(l)},null,8,["timetable"])):R("",!0)]),_:1})],64)}}}),Ne=de(Ae,[["__scopeId","data-v-1b415fb5"]]),Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{De as u,Ye as v};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./timetable__day_view.aWB9z64I.js","./entry.tQWHpBLf.js","./entry.JkaK1PbT.css","./VMenu.CmTKH41A.js","./VOverlay.1V9m9YmJ.js","./easing.imumzmxr.js","./VRow.WlLBb9Jc.js","./VRow.Jj_ITn01.css","./lazy.hsVx4m50.js","./transition.31NosCAE.js","./VOverlay.XsbusQk2.css","./forwardRefs.y8pOSn8h.js","./dialog-transition.OyYDh7J5.js","./index.AmeJTHgO.js","./index.RLmRraAs.css","./VMenu.d2mYOYiy.css","./VDialog.SCbeIy52.js","./VDialog.lRypuzw5.css","./use-notification.Rdal1ke4.js","./useSlotCourse.xKZgOLu0.js","./use-fetch-header.3DHnPbz-.js","./use-logger.h09id-NO.js","./VChip.ttJWPZTa.js","./index.qvKOBlyP.js","./VBtn._oQ1uiNP.js","./VProgressCircular.DTBbBXDU.js","./VProgressCircular.u2v1YYMj.css","./VBtn.Y_2JgC81.css","./VAvatar.NX62-iRj.js","./VAvatar.Y9acgeJC.css","./VChip.y9TZEtu3.css","./VList.lljtylUW.js","./ssrBoot.0aXw1rzb.js","./createSimpleFunctional.413Od-xt.js","./VDivider.KeqwIEcH.js","./VDivider.8k_-HhJN.css","./VList.caQDbXay.css","./VCard.T8BHTP73.js","./VCard.3-GUCx0W.css","./VAutocomplete.6WsM3riW.js","./VSelect.4u-stGGs.js","./VTextField.6LPIlZmm.js","./VInput.AAxW8xuy.js","./VInput.RlDaFj_L.css","./VTextField.TVPDxnpH.css","./VCheckboxBtn.ztQGvB4X.js","./VCheckboxBtn.ENbCW1_T.css","./VSelect.VhdMMxMj.css","./filter.y4xAiLA_.js","./VAutocomplete.smHtj5vg.css","./fetch.EGa3nfvI.js","./VContainer.HgjfEFlY.js","./timetable__day_view.XrOpTuaF.css","./make_complain.cJcIYdv_.js","./useGlobalView.1_iJaLaV.js","./VTextarea.JjGoSqnJ.js","./VTextarea.duhvy6N3.css","./layout.RwfjoJ97.js","./make_complain.LhxUrrUp.css","./navigation_bar.6kAtJ7-T.js","./is-authenticated.2_vl-wsG.js","./is-authenticated.MRbMt392.css","./departments-store.L9CsyjDw.js","./courses-store.hFHtJJlz.js","./complain-store.LCm3VWOX.js","./types.H3O6Ekup.js","./VExpansionPanels.Cp-9pIPO.js","./VExpansionPanels.RUZ5Akns.css","./VExpansionPanel.ju_wnrv-.js","./VCheckbox.SuWXhtYw.js","./VCheckbox.Flv8K2j6.css","./VAlert.9L9TAqJu.js","./VAlert.9fEOfC_e.css","./VSkeletonLoader.bS24LWfm.js","./VSkeletonLoader.ENVXDrOk.css","./VNavigationDrawer.Qf0a9uN4.js","./VNavigationDrawer.vCvlxCCs.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}